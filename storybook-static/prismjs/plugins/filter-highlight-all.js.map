{"version":3,"file":"filter-highlight-all.js","sources":["../../src/plugins/filter-highlight-all/filter-highlight-all.js"],"sourcesContent":["import prism from '../../global.js';\nimport { getLanguage } from '../../shared/dom-util.js';\n\nexport class FilterHighlightAll {\n\t/**\n\t * @type {((element: Element) => boolean)[]}\n\t */\n\tfilters = [];\n\t/**\n\t * Filters the elements of `highlightAll` and `highlightAllUnder` such that only elements with a known language\n\t * will be highlighted. All elements with an unset or unknown language will be ignored.\n\t *\n\t * __Note:__ This will effectively disable the AutoLoader plugin.\n\t *\n\t * @default false\n\t */\n\tfilterKnown = false;\n\n\t/**\n\t * Adds a new filter for the elements of `highlightAll` and `highlightAllUnder` such that only elements for\n\t * which the given function returns `true` will be highlighted.\n\t *\n\t * @param {Condition} condition\n\t */\n\tadd (condition) {\n\t\tthis.filters.push(element => {\n\t\t\treturn condition({\n\t\t\t\telement,\n\t\t\t\tlanguage: getLanguage(element),\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Adds a new filter for the elements of `highlightAll` and `highlightAllUnder` such that only elements that\n\t * match the given CSS selection will be highlighted.\n\t *\n\t * @param {string} selector\n\t */\n\taddSelector (selector) {\n\t\tthis.filters.push(element => {\n\t\t\treturn element.matches(selector);\n\t\t});\n\t}\n\n\treject = {\n\t\t/**\n\t\t * Adds a new filter for the elements of `highlightAll` and `highlightAllUnder` such that only elements for\n\t\t * which the given function returns `false` will be highlighted.\n\t\t *\n\t\t * @param {Condition} condition\n\t\t */\n\t\tadd: condition => {\n\t\t\tthis.add(value => !condition(value));\n\t\t},\n\n\t\t/**\n\t\t * Adds a new filter for the elements of `highlightAll` and `highlightAllUnder` such that only elements that do\n\t\t * not match the given CSS selection will be highlighted.\n\t\t *\n\t\t * @param {string} selector\n\t\t */\n\t\taddSelector: selector => {\n\t\t\tthis.filters.push(element => {\n\t\t\t\treturn !element.matches(selector);\n\t\t\t});\n\t\t},\n\t};\n\n\t/**\n\t * Applies all filters to the given element and returns `true` if and only if every filter returned `true` on the\n\t * given element.\n\t *\n\t * @param {Element} element\n\t * @returns {boolean}\n\t */\n\teveryFilter (element) {\n\t\tfor (const filter of this.filters) {\n\t\t\tif (!filter(element)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n}\n\n/** @type {import('../../types.d.ts').PluginProto<'filter-highlight-all'>} */\nconst Self = {\n\tid: 'filter-highlight-all',\n\tplugin (Prism) {\n\t\tconst config = new FilterHighlightAll();\n\n\t\tconfig.add(env => {\n\t\t\treturn !config.filterKnown || Prism.languageRegistry.has(env.language);\n\t\t});\n\n\t\tif (typeof document !== 'undefined') {\n\t\t\tconst script = document.currentScript;\n\t\t\tif (script) {\n\t\t\t\tconfig.filterKnown = script.hasAttribute('data-filter-known');\n\n\t\t\t\tlet attr;\n\t\t\t\tattr = script.getAttribute('data-filter-selector');\n\t\t\t\tif (attr) {\n\t\t\t\t\tconfig.addSelector(attr);\n\t\t\t\t}\n\t\t\t\tattr = script.getAttribute('data-reject-selector');\n\t\t\t\tif (attr) {\n\t\t\t\t\tconfig.reject.addSelector(attr);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn config;\n\t},\n\teffect (Prism) {\n\t\t/** @type {FilterHighlightAll} */\n\t\tconst config = Prism.pluginRegistry.peek(Self)?.plugin;\n\n\t\treturn Prism.hooks.add('before-all-elements-highlight', env => {\n\t\t\tenv.elements = env.elements.filter(e => config.everyFilter(e));\n\t\t});\n\t},\n};\n\nexport default Self;\n\nprism.pluginRegistry.add(Self);\n\n/**\n * @callback Condition\n * @param {{ element: Element, language: string }} value\n * @returns {boolean}\n */\n"],"names":["FilterHighlightAll","filters","filterKnown","add","condition","this","push","element","language","getLanguage","addSelector","selector","matches","reject","value","everyFilter","filter","Self","id","plugin","Prism","config","env","languageRegistry","has","document","script","currentScript","attr","hasAttribute","getAttribute","effect","pluginRegistry","peek","hooks","elements","e","prism"],"mappings":"wKAGO,MAAMA,mBAIZC,QAAU,GASVC,aAAc,EAQd,GAAAC,CAAKC,GACJC,KAAKJ,QAAQK,MAAKC,GACVH,EAAU,CAChBG,UACAC,SAAUC,EAAYF,MAG1B,CAQC,WAAAG,CAAaC,GACZN,KAAKJ,QAAQK,MAAKC,GACVA,EAAQK,QAAQD,IAE1B,CAECE,OAAS,CAORV,IAAKC,IACJC,KAAKF,KAAIW,IAAUV,EAAUU,IAAO,EASrCJ,YAAaC,IACZN,KAAKJ,QAAQK,MAAKC,IACTA,EAAQK,QAAQD,IACvB,GAWJ,WAAAI,CAAaR,GACZ,IAAK,MAAMS,KAAUX,KAAKJ,QACzB,IAAKe,EAAOT,GACX,OAAO,EAGT,OAAO,CACT,EAIK,MAACU,EAAO,CACZC,GAAI,uBACJ,MAAAC,CAAQC,GACP,MAAMC,EAAS,IAAIrB,mBAMnB,GAJAqB,EAAOlB,KAAImB,IACFD,EAAOnB,aAAekB,EAAMG,iBAAiBC,IAAIF,EAAId,YAGtC,oBAAbiB,SAA0B,CACpC,MAAMC,EAASD,SAASE,cACxB,GAAID,EAAQ,CAGX,IAAIE,EAFJP,EAAOnB,YAAcwB,EAAOG,aAAa,qBAGzCD,EAAOF,EAAOI,aAAa,wBACvBF,GACHP,EAAOX,YAAYkB,GAEpBA,EAAOF,EAAOI,aAAa,wBACvBF,GACHP,EAAOR,OAAOH,YAAYkB,EAE/B,CACA,CAEE,OAAOP,CACP,EACD,MAAAU,CAAQX,GAEP,MAAMC,EAASD,EAAMY,eAAeC,KAAKhB,IAAOE,OAEhD,OAAOC,EAAMc,MAAM/B,IAAI,iCAAiCmB,IACvDA,EAAIa,SAAWb,EAAIa,SAASnB,QAAOoB,GAAKf,EAAON,YAAYqB,IAAG,GAE/D,GAKFC,EAAML,eAAe7B,IAAIc"}