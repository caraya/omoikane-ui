{"version":3,"file":"autolinker.js","sources":["../../src/plugins/autolinker/autolinker.js"],"sourcesContent":["import prism from '../../global.js';\nimport { tokenizeStrings } from '../../shared/tokenize-strings.js';\n\n/** @type {import('../../types.d.ts').PluginProto<'autolinker'>} */\nconst Self = {\n\tid: 'autolinker',\n\toptional: 'diff-highlight',\n\teffect (Prism) {\n\t\t/**\n\t\t * @param {string} chars\n\t\t * @returns {string}\n\t\t */\n\t\tfunction balanced (chars) {\n\t\t\treturn String.raw`(?:${chars}|\\((?:${chars})*\\))`;\n\t\t}\n\n\t\tconst url = RegExp(\n\t\t\t/\\b(?:[a-z]{3,7}:\\/\\/|tel:)/.source +\n\t\t\t\t`${balanced(/[\\w\\-+%~/.:=&!$'*,;@]/.source)}+` +\n\t\t\t\t`(?:\\\\?${balanced(/[\\w\\-+%~/.:=&!$'*,;@?]/.source)}*)?` +\n\t\t\t\t`(?:#${balanced(/[\\w\\-+%~/.:=&!$'*,;@?#]/.source)}*)?`\n\t\t);\n\t\tconst email = /\\b\\S+@[\\w.]+[a-z]{2}/;\n\n\t\tconst links = {\n\t\t\t'url-link': url,\n\t\t\t'email-link': email,\n\t\t};\n\n\t\treturn Prism.hooks.add({\n\t\t\t'after-tokenize': env => {\n\t\t\t\ttokenizeStrings(env.tokens, code => Prism.tokenize(code, links));\n\t\t\t},\n\t\t\t'wrap': env => {\n\t\t\t\tif (env.type.endsWith('-link')) {\n\t\t\t\t\tlet href = env.content;\n\n\t\t\t\t\tif (env.type === 'email-link' && !href.startsWith('mailto:')) {\n\t\t\t\t\t\thref = 'mailto:' + href;\n\t\t\t\t\t}\n\n\t\t\t\t\tenv.tag = 'a';\n\t\t\t\t\tenv.attributes.href = href;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n};\n\nexport default Self;\n\nprism.pluginRegistry.add(Self);\n"],"names":["Self","id","optional","effect","Prism","balanced","chars","String","raw","links","RegExp","hooks","add","env","tokenizeStrings","tokens","code","tokenize","wrap","type","endsWith","href","content","startsWith","tag","attributes","prism","pluginRegistry"],"mappings":"qNAIK,MAACA,EAAO,CACZC,GAAI,aACJC,SAAU,iBACV,MAAAC,CAAQC,GAKP,SAASC,EAAUC,GAClB,OAAOC,OAAOC,GAAG,MAAMF,UAAcA,QACxC,CAEE,MAQMG,EAAQ,CACb,WATWC,OACX,4BACIL,EAAS,2BAAZ,IACA,SAASA,EAAS,iCAClB,OAAOA,EAAS,mCAMjB,aAJa,wBAOd,OAAOD,EAAMO,MAAMC,IAAI,CACtB,iBAAkBC,IACjBC,EAAgBD,EAAIE,QAAQC,GAAQZ,EAAMa,SAASD,EAAMP,IAAO,EAEjES,KAAQL,IACP,GAAIA,EAAIM,KAAKC,SAAS,SAAU,CAC/B,IAAIC,EAAOR,EAAIS,QAEE,eAAbT,EAAIM,MAA0BE,EAAKE,WAAW,aACjDF,EAAO,UAAYA,GAGpBR,EAAIW,IAAM,IACVX,EAAIY,WAAWJ,KAAOA,CAC3B,IAGE,GAKFK,EAAMC,eAAef,IAAIZ"}