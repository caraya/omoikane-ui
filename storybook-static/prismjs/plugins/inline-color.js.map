{"version":3,"file":"inline-color.js","sources":["../../src/plugins/inline-color/inline-color.js"],"sourcesContent":["import prism from '../../global.js';\nimport cssExtras from '../../languages/css-extras.js';\nimport { MARKUP_TAG } from '../../shared/languages/patterns.js';\n\nconst HTML_TAG = RegExp(MARKUP_TAG, 'g');\n\n// a regex to validate hexadecimal colors\nconst HEX_COLOR = /^#?((?:[\\da-f]){3,4}|(?:[\\da-f]{2}){3,4})$/i;\n\n/**\n * Parses the given hexadecimal representation and returns the parsed RGBA color.\n *\n * If the format of the given string is invalid, `undefined` will be returned.\n * Valid formats are: `RGB`, `RGBA`, `RRGGBB`, and `RRGGBBAA`.\n *\n * Hexadecimal colors are parsed because they are not fully supported by older browsers, so converting them to\n * `rgba` functions improves browser compatibility.\n *\n * @param {string} hex\n * @returns {string | undefined}\n */\nfunction parseHexColor (hex) {\n\tconst match = HEX_COLOR.exec(hex);\n\tif (!match) {\n\t\treturn undefined;\n\t}\n\thex = match[1]; // removes the leading \"#\"\n\n\t// the width and number of channels\n\tconst channelWidth = hex.length >= 6 ? 2 : 1;\n\tconst channelCount = hex.length / channelWidth;\n\n\t// the scale used to normalize 4bit and 8bit values\n\tconst scale = channelWidth === 1 ? 1 / 15 : 1 / 255;\n\n\t// normalized RGBA channels\n\tconst channels = [];\n\tfor (let i = 0; i < channelCount; i++) {\n\t\tconst int = parseInt(hex.substr(i * channelWidth, channelWidth), 16);\n\t\tchannels.push(int * scale);\n\t}\n\tif (channelCount === 3) {\n\t\tchannels.push(1); // add alpha of 100%\n\t}\n\n\t// output\n\tconst rgb = channels\n\t\t.slice(0, 3)\n\t\t.map(x => {\n\t\t\treturn String(Math.round(x * 255));\n\t\t})\n\t\t.join(',');\n\tconst alpha = String(Number(channels[3].toFixed(3))); // easy way to round 3 decimal places\n\n\treturn 'rgba(' + rgb + ',' + alpha + ')';\n}\n\n/**\n * Validates the given Color using the current browser's internal implementation.\n *\n * @param {string} color\n * @returns {string | undefined}\n */\nfunction validateColor (color) {\n\tif (typeof document === 'undefined') {\n\t\treturn undefined;\n\t}\n\n\tconst s = new Option().style;\n\ts.color = color;\n\treturn s.color ? color : undefined;\n}\n\n/** @type {import('../../types.d.ts').PluginProto<'inline-color'>} */\nconst Self = {\n\tid: 'inline-color',\n\trequire: cssExtras,\n\teffect (Prism) {\n\t\t/**\n\t\t * An array of function which parse a given string representation of a color.\n\t\t *\n\t\t * These parser serve as validators and as a layer of compatibility to support color formats which the browser\n\t\t * might not support natively.\n\t\t */\n\t\tconst parsers = [parseHexColor, validateColor];\n\n\t\treturn Prism.hooks.add('wrap', env => {\n\t\t\tif (env.type === 'color' || env.classes.includes('color')) {\n\t\t\t\tconst content = env.content;\n\n\t\t\t\t// remove all HTML tags inside\n\t\t\t\tconst rawText = content.split(HTML_TAG).join('');\n\n\t\t\t\tlet color;\n\t\t\t\tfor (let i = 0, l = parsers.length; i < l && !color; i++) {\n\t\t\t\t\tcolor = parsers[i](rawText);\n\t\t\t\t}\n\n\t\t\t\tif (!color) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst previewElement =\n\t\t\t\t\t'<span class=\"inline-color-wrapper\"><span class=\"inline-color\" style=\"background-color:' +\n\t\t\t\t\tcolor +\n\t\t\t\t\t';\"></span></span>';\n\t\t\t\tenv.content = previewElement + content;\n\t\t\t}\n\t\t});\n\t},\n};\n\nexport default Self;\n\nprism.pluginRegistry.add(Self);\n"],"names":["HTML_TAG","RegExp","MARKUP_TAG","HEX_COLOR","parseHexColor","hex","match","exec","channelWidth","length","channelCount","scale","channels","i","int","parseInt","substr","push","slice","map","x","Math","round","String","join","toFixed","validateColor","color","document","s","Option","style","undefined","Self","id","require","cssExtras","effect","Prism","parsers","hooks","add","env","type","classes","includes","content","rawText","split","l","previewElement","prism","pluginRegistry"],"mappings":"4RAIA,MAAMA,EAAWC,OAAOC,EAAY,KAG9BC,EAAY,8CAclB,SAASC,EAAeC,GACvB,MAAMC,EAAQH,EAAUI,KAAKF,GAC7B,IAAKC,EACJ,OAKD,MAAME,GAHNH,EAAMC,EAAM,IAGaG,QAAU,EAAI,EAAI,EACrCC,EAAeL,EAAII,OAASD,EAG5BG,EAAyB,IAAjBH,EAAqB,EAAI,GAAK,EAAI,IAG1CI,EAAW,GACjB,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAcG,IAAK,CACtC,MAAMC,EAAMC,SAASV,EAAIW,OAAOH,EAAIL,EAAcA,GAAe,IACjEI,EAASK,KAAKH,EAAMH,EACtB,CAcC,OAbqB,IAAjBD,GACHE,EAASK,KAAK,GAYR,QARKL,EACVM,MAAM,EAAG,GACTC,KAAIC,GACUC,KAAKC,MAAU,IAAJF,GAAlBG,KAEPC,KAAK,KAGgB,MAFKZ,EAAS,GAAGa,QAAQ,GAEX,GACtC,CAQA,SAASC,EAAeC,GACvB,GAAwB,oBAAbC,SACV,OAGD,MAAMC,GAAI,IAAIC,QAASC,MAEvB,OADAF,EAAEF,MAAQA,EACHE,EAAEF,MAAQA,OAAQK,CAC1B,CAGK,MAACC,EAAO,CACZC,GAAI,eACJC,QAASC,EACT,MAAAC,CAAQC,GAOP,MAAMC,EAAU,CAACnC,EAAesB,GAEhC,OAAOY,EAAME,MAAMC,IAAI,QAAQC,IAC9B,GAAiB,UAAbA,EAAIC,MAAoBD,EAAIE,QAAQC,SAAS,SAAU,CAC1D,MAAMC,EAAUJ,EAAII,QAGdC,EAAUD,EAAQE,MAAMhD,GAAUwB,KAAK,IAE7C,IAAIG,EACJ,IAAK,IAAId,EAAI,EAAGoC,EAAIV,EAAQ9B,OAAQI,EAAIoC,IAAMtB,EAAOd,IACpDc,EAAQY,EAAQ1B,GAAGkC,GAGpB,IAAKpB,EACJ,OAGD,MAAMuB,EACL,yFACAvB,EACA,oBACDe,EAAII,QAAUI,EAAiBJ,CACnC,IAEE,GAKFK,EAAMC,eAAeX,IAAIR"}