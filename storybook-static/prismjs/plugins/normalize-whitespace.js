import{p as e,i as t,g as n}from"../prism-DU08x7FD.js";import"../util-DdJteTVJ.js";import"../token-Dozwbq7Q.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";function r(e){let t=0;for(let n=0;n<e.length;++n)9===e.charCodeAt(n)&&(t+=3);return e.length+t}const i=["remove-trailing","remove-indent","left-trim","right-trim","break-lines","indent","remove-initial-line-feed","tabs-to-spaces","spaces-to-tabs"],o={"remove-trailing":"boolean","remove-indent":"boolean","left-trim":"boolean","right-trim":"boolean","break-lines":"number",indent:"number","remove-initial-line-feed":"boolean","tabs-to-spaces":"number","spaces-to-tabs":"number"},l={"left-trim":e=>e.replace(/^\s+/,""),"right-trim":e=>e.replace(/(^|\S)\s+$/,"$1"),"tabs-to-spaces":(e,t)=>e.replace(/\t/g," ".repeat(t)),"spaces-to-tabs":(e,t)=>e.replace(RegExp(` {${t}}`,"g"),"\t"),"remove-trailing":e=>e.replace(/\s*?$/gm,""),"remove-initial-line-feed":e=>e.replace(/^(?:\r?\n|\r)/,""),"remove-indent":e=>{const t=e.match(/^[^\S\n\r]*(?=\S)/gm);return t&&t[0].length?(t.sort(((e,t)=>e.length-t.length)),t[0].length?e.replace(RegExp("^"+t[0],"gm"),""):e):e},indent:(e,t)=>e.replace(/^[^\S\n\r]*(?=\S)/gm,"\t".repeat(t)+"$&"),"break-lines":(e,t)=>{const n=e.split("\n");for(let e=0;e<n.length;++e){if(r(n[e])<=t)continue;const i=n[e].split(/(\s+)/);let o=0;for(let e=0;e<i.length;++e){const n=r(i[e]);o+=n,o>t&&(i[e]="\n"+i[e],o=n)}n[e]=i.join("")}return n.join("\n")}};class NormalizeWhitespace{defaults;constructor(e){this.defaults={...e}}setDefaults(e){Object.assign(this.defaults,e)}normalize(e,t){t={...this.defaults,...t};for(const n of i){const r=t[n];void 0!==r&&!1!==r&&(e=l[n](e,r))}return e}}const s={id:"normalize-whitespace",optional:"unescaped-markup",plugin:()=>new NormalizeWhitespace({"remove-trailing":!0,"remove-indent":!0,"left-trim":!0,"right-trim":!0}),effect(e){const r=e.pluginRegistry.peek(s)?.plugin;return e.hooks.add("before-sanity-check",(l=>{if(!l.code)return;if(!t(l.element,"whitespace-normalization",!0))return;if(!l.element.parentNode)return void(l.code=r.normalize(l.code));const s=n(l.element);if(!s)return;const a=(e=>{const t={};for(const n of i){const r=e.getAttribute("data-"+n),i=o[n];if(null!==r)try{const e=JSON.parse(r||"true");typeof e===i&&(t[n]=e)}catch{}}return t})(s),c=s.childNodes;let m="",p="",d=!1;for(let e=0;e<c.length;++e){const t=c[e];t===l.element?d=!0:"#text"===t.nodeName&&(d?p+=t.nodeValue:m+=t.nodeValue,s.removeChild(t),--e)}if(l.element.children.length&&e.pluginRegistry.has("keep-markup")){const e=m+l.element.innerHTML+p;l.element.innerHTML=r.normalize(e,a),l.code=l.element.textContent||""}else l.code=m+l.code+p,l.code=r.normalize(l.code,a)}))}};e.pluginRegistry.add(s);export{NormalizeWhitespace,s as default};
