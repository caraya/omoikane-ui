import{p as e,g as t,i as n}from"../prism-DU08x7FD.js";import{n as r,i}from"../util-DdJteTVJ.js";import{c as s}from"../combine-callbacks-CN2XYGOO.js";import"../token-Dozwbq7Q.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";const o="line-numbers",l=/\n(?!$)/g;function a(e){return e.querySelector(".line-numbers-rows")}function c(e){if(0===(e=e.filter((e=>{const t=getComputedStyle(e).whiteSpace;return"pre-wrap"===t||"pre-line"===t}))).length)return;const t=e.map((e=>{const t=e.querySelector("code"),n=a(e);if(!t||!n)return;let r=e.querySelector(".line-numbers-sizer");const i=t.textContent.split(l);r||(r=document.createElement("span"),r.className="line-numbers-sizer",t.appendChild(r)),r.innerHTML="0",r.style.display="block";const s=r.getBoundingClientRect().height;return r.innerHTML="",{element:e,lines:i,lineHeights:[],oneLinerHeight:s,sizer:r,wrapper:n}})).filter(i);t.forEach((e=>{const t=e.sizer,n=e.lines,r=e.lineHeights,i=e.oneLinerHeight;r[n.length-1]=void 0,n.forEach(((e,n)=>{if(e&&e.length>1){const n=t.appendChild(document.createElement("span"));n.style.display="block",n.textContent=e}else r[n]=i}))})),t.forEach((e=>{const t=e.sizer,n=e.lineHeights;let r=0;for(let e=0;e<n.length;e++)void 0===n[e]&&(n[e]=t.children[r++].getBoundingClientRect().height)})),t.forEach((e=>{const t=e.sizer;t.style.display="none",t.innerHTML="",e.lineHeights.forEach(((t,n)=>{void 0!==t&&(e.wrapper.children[n].style.height=t+"px")}))}))}class LineNumbers{assumeViewportIndependence=!0;getLine(e,t){if("PRE"!==e.tagName||!e.classList.contains(o))return;const n=a(e);if(!n)return;const r=parseInt(e.getAttribute("data-start")+"",10)||1,i=r+(n.children.length-1);t<r&&(t=r),t>i&&(t=i);const s=t-r;return n.children[s]}getLines(e){if("PRE"!==e.tagName||!e.classList.contains(o))return;const t=a(e);return t?[...t.children]:void 0}resize(e){c([e])}}const d={id:"line-numbers",plugin:()=>new LineNumbers,effect(e){if("undefined"==typeof document)return r;let i=NaN;const u=()=>{const t=e.pluginRegistry.peek(d)?.plugin;t.assumeViewportIndependence&&i===window.innerWidth||(i=window.innerWidth,c([...document.querySelectorAll("pre."+o)]))};window.addEventListener("resize",u);const p=e.hooks.add("complete",(e=>{if(!e.code)return;const r=e.element,i=t(r);if(!i)return;if(a(r))return;if(!n(r,o))return;r.classList.remove(o),i.classList.add(o);const s=e.code.match(l),d=s?s.length+1:1,u=document.createElement("span");u.setAttribute("aria-hidden","true"),u.className="line-numbers-rows",u.innerHTML="<span></span>".repeat(d),i.hasAttribute("data-start")&&(i.style.counterReset="linenumber "+(parseInt(i.getAttribute("data-start")+"",10)-1)),e.element.appendChild(u),c([i])}));return s((()=>{window.removeEventListener("resize",u)}),p)}};e.pluginRegistry.add(d);export{LineNumbers,d as default};
