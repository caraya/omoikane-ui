{"version":3,"file":"naniscript.js","sources":["../../src/languages/naniscript.js"],"sourcesContent":["import { getTextContent } from '../core/classes/token.js';\nimport { withoutTokenize } from '../util/language-util.js';\n\n/**\n * @param {string} input\n * @returns {boolean}\n */\nfunction isBracketsBalanced (input) {\n\tconst brackets = '[]{}';\n\tconst stack = [];\n\tfor (let i = 0; i < input.length; i++) {\n\t\tconst bracket = input[i];\n\t\tconst bracketsIndex = brackets.indexOf(bracket);\n\t\tif (bracketsIndex !== -1) {\n\t\t\tif (bracketsIndex % 2 === 0) {\n\t\t\t\tstack.push(bracketsIndex + 1);\n\t\t\t}\n\t\t\telse if (stack.pop() !== bracketsIndex) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn stack.length === 0;\n}\n\n/** @type {import('../types.d.ts').LanguageProto<'naniscript'>} */\nexport default {\n\tid: 'naniscript',\n\talias: 'nani',\n\tgrammar () {\n\t\tconst expressionDef = /\\{[^\\r\\n\\[\\]{}]*\\}/;\n\n\t\tconst params = {\n\t\t\t'quoted-string': {\n\t\t\t\tpattern: /\"(?:[^\"\\\\]|\\\\.)*\"/,\n\t\t\t\talias: 'operator',\n\t\t\t},\n\t\t\t'command-param-id': {\n\t\t\t\tpattern: /(\\s)\\w+:/,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'property',\n\t\t\t},\n\t\t\t'command-param-value': [\n\t\t\t\t{\n\t\t\t\t\tpattern: expressionDef,\n\t\t\t\t\talias: 'selector',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpattern: /([\\t ])\\S+/,\n\t\t\t\t\tlookbehind: true,\n\t\t\t\t\tgreedy: true,\n\t\t\t\t\talias: 'operator',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpattern: /\\S(?:.*\\S)?/,\n\t\t\t\t\talias: 'operator',\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\t// ; ...\n\t\t\t'comment': {\n\t\t\t\tpattern: /^([\\t ]*);.*/m,\n\t\t\t\tlookbehind: true,\n\t\t\t},\n\t\t\t// > ...\n\t\t\t// Define is a control line starting with '>' followed by a word, a space and a text.\n\t\t\t'define': {\n\t\t\t\tpattern: /^>.+/m,\n\t\t\t\talias: 'tag',\n\t\t\t\tinside: {\n\t\t\t\t\t'value': {\n\t\t\t\t\t\tpattern: /(^>\\w+[\\t ]+)(?!\\s)[^{}\\r\\n]+/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'operator',\n\t\t\t\t\t},\n\t\t\t\t\t'key': {\n\t\t\t\t\t\tpattern: /(^>)\\w+/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t// # ...\n\t\t\t'label': {\n\t\t\t\tpattern: /^([\\t ]*)#[\\t ]*\\w+[\\t ]*$/m,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'regex',\n\t\t\t},\n\t\t\t'command': {\n\t\t\t\tpattern: /^([\\t ]*)@\\w+(?=[\\t ]|$).*/m,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'function',\n\t\t\t\tinside: {\n\t\t\t\t\t'command-name': /^@\\w+/,\n\t\t\t\t\t'expression': {\n\t\t\t\t\t\tpattern: expressionDef,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\talias: 'selector',\n\t\t\t\t\t},\n\t\t\t\t\t'command-params': {\n\t\t\t\t\t\tpattern: /\\s*\\S[\\s\\S]*/,\n\t\t\t\t\t\tinside: params,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t// Generic is any line that doesn't start with operators: ;>#@\n\t\t\t'generic-text': {\n\t\t\t\tpattern: /(^[ \\t]*)[^#@>;\\s].*/m,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'punctuation',\n\t\t\t\tinside: {\n\t\t\t\t\t// \\{ ... \\} ... \\[ ... \\] ... \\\"\n\t\t\t\t\t'escaped-char': /\\\\[{}\\[\\]\"]/,\n\t\t\t\t\t'expression': {\n\t\t\t\t\t\tpattern: expressionDef,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\talias: 'selector',\n\t\t\t\t\t},\n\t\t\t\t\t'inline-command': {\n\t\t\t\t\t\tpattern: /\\[[\\t ]*\\w[^\\r\\n\\[\\]]*\\]/,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\talias: 'function',\n\t\t\t\t\t\tinside: {\n\t\t\t\t\t\t\t'command-params': {\n\t\t\t\t\t\t\t\tpattern: /(^\\[[\\t ]*\\w+\\b)[\\s\\S]+(?=\\]$)/,\n\t\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\t\tinside: params,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t'command-param-name': {\n\t\t\t\t\t\t\t\tpattern: /^(\\[[\\t ]*)\\w+/,\n\t\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\t\talias: 'name',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t'start-stop-char': /[\\[\\]]/,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\n\t\t\t$tokenize (code, grammar, Prism) {\n\t\t\t\tconst tokens = Prism.tokenize(code, withoutTokenize(grammar));\n\t\t\t\ttokens.forEach(token => {\n\t\t\t\t\tif (typeof token !== 'string' && token.type === 'generic-text') {\n\t\t\t\t\t\tconst content = getTextContent(token);\n\t\t\t\t\t\tif (!isBracketsBalanced(content)) {\n\t\t\t\t\t\t\ttoken.type = 'bad-line';\n\t\t\t\t\t\t\ttoken.content = content;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn tokens;\n\t\t\t},\n\t\t};\n\t},\n};\n"],"names":["naniscript","id","alias","grammar","expressionDef","params","pattern","lookbehind","greedy","comment","define","inside","value","key","label","command","expression","$tokenize","code","Prism","tokens","tokenize","withoutTokenize","forEach","token","type","content","getTextContent","input","stack","i","length","bracket","bracketsIndex","indexOf","push","pop","isBracketsBalanced"],"mappings":"6FA0BA,IAAeA,EAAA,CACdC,GAAI,aACJC,MAAO,OACP,OAAAC,GACC,MAAMC,EAAgB,qBAEhBC,EAAS,CACd,gBAAiB,CAChBC,QAAS,oBACTJ,MAAO,YAER,mBAAoB,CACnBI,QAAS,WACTC,YAAY,EACZL,MAAO,YAER,sBAAuB,CACtB,CACCI,QAASF,EACTF,MAAO,YAER,CACCI,QAAS,aACTC,YAAY,EACZC,QAAQ,EACRN,MAAO,YAER,CACCI,QAAS,cACTJ,MAAO,cAKV,MAAO,CAENO,QAAW,CACVH,QAAS,gBACTC,YAAY,GAIbG,OAAU,CACTJ,QAAS,QACTJ,MAAO,MACPS,OAAQ,CACPC,MAAS,CACRN,QAAS,gCACTC,YAAY,EACZL,MAAO,YAERW,IAAO,CACNP,QAAS,UACTC,YAAY,KAKfO,MAAS,CACRR,QAAS,8BACTC,YAAY,EACZL,MAAO,SAERa,QAAW,CACVT,QAAS,8BACTC,YAAY,EACZL,MAAO,WACPS,OAAQ,CACP,eAAgB,QAChBK,WAAc,CACbV,QAASF,EACTI,QAAQ,EACRN,MAAO,YAER,iBAAkB,CACjBI,QAAS,eACTK,OAAQN,KAKX,eAAgB,CACfC,QAAS,wBACTC,YAAY,EACZL,MAAO,cACPS,OAAQ,CAEP,eAAgB,cAChBK,WAAc,CACbV,QAASF,EACTI,QAAQ,EACRN,MAAO,YAER,iBAAkB,CACjBI,QAAS,2BACTE,QAAQ,EACRN,MAAO,WACPS,OAAQ,CACP,iBAAkB,CACjBL,QAAS,iCACTC,YAAY,EACZI,OAAQN,GAET,qBAAsB,CACrBC,QAAS,iBACTC,YAAY,EACZL,MAAO,QAER,kBAAmB,aAMvB,SAAAe,CAAWC,EAAMf,EAASgB,GACzB,MAAMC,EAASD,EAAME,SAASH,EAAMI,EAAgBnB,IAUpD,OATAiB,EAAOG,SAAQC,IACd,GAAqB,iBAAVA,GAAqC,iBAAfA,EAAMC,KAAyB,CAC/D,MAAMC,EAAUC,EAAeH,GAzIrC,CAA6BI,IAC5B,MACMC,EAAQ,GACd,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAMG,OAAQD,IAAK,CACtC,MAAME,EAAUJ,EAAME,GAChBG,EAJU,OAIeC,QAAQF,GACvC,IAAsB,IAAlBC,EACH,GAAIA,EAAgB,GAAM,EACzBJ,EAAMM,KAAKF,EAAgB,QAEvB,GAAIJ,EAAMO,QAAUH,EACxB,OAAO,CAGX,CACC,OAAwB,IAAjBJ,EAAME,MACd,EA0HWM,CAAmBX,KACvBF,EAAMC,KAAO,WACbD,EAAME,QAAUA,EAEvB,KAEWN,CACP,EAEF"}