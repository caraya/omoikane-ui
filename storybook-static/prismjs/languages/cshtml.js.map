{"version":3,"file":"cshtml.js","sources":["../../src/languages/cshtml.js"],"sourcesContent":["import { insertBefore } from '../util/language-util.js';\nimport csharp from './csharp.js';\nimport markup from './markup.js';\n\n/** @type {import('../types.d.ts').LanguageProto<'cshtml'>} */\nexport default {\n\tid: 'cshtml',\n\tbase: markup,\n\trequire: csharp,\n\talias: 'razor',\n\tgrammar ({ extend }) {\n\t\t// Docs:\n\t\t// https://docs.microsoft.com/en-us/aspnet/core/razor-pages/?view=aspnetcore-5.0&tabs=visual-studio\n\t\t// https://docs.microsoft.com/en-us/aspnet/core/mvc/views/razor?view=aspnetcore-5.0\n\n\t\tconst commentLike = /\\/(?![/*])|\\/\\/.*[\\r\\n]|\\/\\*[^*]*(?:\\*(?!\\/)[^*]*)*\\*\\//.source;\n\t\tconst stringLike =\n\t\t\t/@(?!\")|\"(?:[^\\r\\n\\\\\"]|\\\\.)*\"|@\"(?:[^\\\\\"]|\"\"|\\\\[\\s\\S])*\"(?!\")/.source +\n\t\t\t'|' +\n\t\t\t/'(?:(?:[^\\r\\n'\\\\]|\\\\.|\\\\[Uux][\\da-fA-F]{1,8})'|(?=[^\\\\](?!')))/.source;\n\n\t\t/**\n\t\t * Creates a nested pattern where all occurrences of the string `<<self>>` are replaced with the pattern itself.\n\t\t *\n\t\t * @param {string} pattern\n\t\t * @param {number} depthLog2\n\t\t */\n\t\tfunction nested (pattern, depthLog2) {\n\t\t\tfor (let i = 0; i < depthLog2; i++) {\n\t\t\t\tpattern = pattern.replace(/<self>/g, () => '(?:' + pattern + ')');\n\t\t\t}\n\t\t\treturn pattern\n\t\t\t\t.replace(/<self>/g, '[^\\\\s\\\\S]')\n\t\t\t\t.replace(/<str>/g, '(?:' + stringLike + ')')\n\t\t\t\t.replace(/<comment>/g, '(?:' + commentLike + ')');\n\t\t}\n\n\t\tconst round = nested(/\\((?:[^()'\"@/]|<str>|<comment>|<self>)*\\)/.source, 2);\n\t\tconst square = nested(/\\[(?:[^\\[\\]'\"@/]|<str>|<comment>|<self>)*\\]/.source, 1);\n\t\tconst curly = nested(/\\{(?:[^{}'\"@/]|<str>|<comment>|<self>)*\\}/.source, 2);\n\t\tconst angle = nested(/<(?:[^<>'\"@/]|<comment>|<self>)*>/.source, 1);\n\n\t\tconst inlineCs =\n\t\t\t/@/.source +\n\t\t\t/(?:await\\b\\s*)?/.source +\n\t\t\t'(?:' +\n\t\t\t/(?!await\\b)\\w+\\b/.source +\n\t\t\t'|' +\n\t\t\tround +\n\t\t\t')' +\n\t\t\t'(?:' +\n\t\t\t/[?!]?\\.\\w+\\b/.source +\n\t\t\t'|' +\n\t\t\t'(?:' +\n\t\t\tangle +\n\t\t\t')?' +\n\t\t\tround +\n\t\t\t'|' +\n\t\t\tsquare +\n\t\t\t')*' +\n\t\t\t/(?![?!\\.(\\[]|<(?!\\/))/.source;\n\n\t\t// Note about the above bracket patterns:\n\t\t// They all ignore HTML expressions that might be in the C# code. This is a problem because HTML (like strings and\n\t\t// comments) is parsed differently. This is a huge problem because HTML might contain brackets and quotes which\n\t\t// messes up the bracket and string counting implemented by the above patterns.\n\t\t//\n\t\t// This problem is not fixable because 1) HTML expression are highly context sensitive and very difficult to detect\n\t\t// and 2) they require one capturing group at every nested level. See the `tagRegion` pattern to admire the\n\t\t// complexity of an HTML expression.\n\t\t//\n\t\t// To somewhat alleviate the problem a bit, the patterns for characters (e.g. 'a') is very permissive, it also\n\t\t// allows invalid characters to support HTML expressions like this: <p>That's it!</p>.\n\n\t\tconst tagAttrInlineCs = /@(?![\\w()])/.source + '|' + inlineCs;\n\t\tconst tagAttrValue =\n\t\t\t'(?:' +\n\t\t\t/\"[^\"@]*\"|'[^'@]*'|[^\\s'\"@>=]+(?=[\\s>])/.source +\n\t\t\t'|' +\n\t\t\t'[\"\\'][^\"\\'@]*(?:(?:' +\n\t\t\ttagAttrInlineCs +\n\t\t\t')[^\"\\'@]*)+[\"\\']' +\n\t\t\t')';\n\n\t\tconst tagAttrs =\n\t\t\t/(?:\\s(?:\\s*[^\\s>\\/=]+(?:\\s*=\\s*<tagAttrValue>|(?=[\\s/>])))+)?/.source.replace(\n\t\t\t\t/<tagAttrValue>/,\n\t\t\t\ttagAttrValue\n\t\t\t);\n\t\tconst tagContent = /(?!\\d)[^\\s>\\/=$<%]+/.source + tagAttrs + /\\s*\\/?>/.source;\n\t\tconst tagRegion =\n\t\t\t/\\B@?/.source +\n\t\t\t'(?:' +\n\t\t\t/<([a-zA-Z][\\w:]*)/.source +\n\t\t\ttagAttrs +\n\t\t\t/\\s*>/.source +\n\t\t\t'(?:' +\n\t\t\t(/[^<]/.source +\n\t\t\t\t'|' +\n\t\t\t\t// all tags that are not the start tag\n\t\t\t\t// @ts-expect-error TS(2532): Ignore the non-existent capturing group error.\n\t\t\t\t/<\\/?(?!\\1\\b)/.source + // eslint-disable-line regexp/strict\n\t\t\t\ttagContent +\n\t\t\t\t'|' +\n\t\t\t\t// nested start tag\n\t\t\t\tnested(\n\t\t\t\t\t// @ts-expect-error TS(2532): Ignore the non-existent capturing group error.\n\t\t\t\t\t/<\\1/.source + // eslint-disable-line regexp/strict\n\t\t\t\t\t\ttagAttrs +\n\t\t\t\t\t\t/\\s*>/.source +\n\t\t\t\t\t\t'(?:' +\n\t\t\t\t\t\t(/[^<]/.source +\n\t\t\t\t\t\t\t'|' +\n\t\t\t\t\t\t\t// all tags that are not the start tag\n\t\t\t\t\t\t\t// @ts-expect-error TS(2532): Ignore the non-existent capturing group error.\n\t\t\t\t\t\t\t/<\\/?(?!\\1\\b)/.source + // eslint-disable-line regexp/strict\n\t\t\t\t\t\t\ttagContent +\n\t\t\t\t\t\t\t'|' +\n\t\t\t\t\t\t\t'<self>') +\n\t\t\t\t\t\t')*' +\n\t\t\t\t\t\t// @ts-expect-error TS(2532): Ignore the non-existent capturing group error.\n\t\t\t\t\t\t/<\\/\\1\\s*>/.source, // eslint-disable-line regexp/strict\n\t\t\t\t\t2\n\t\t\t\t)) +\n\t\t\t')*' +\n\t\t\t// @ts-expect-error TS(2532): Ignore the non-existent capturing group error.\n\t\t\t/<\\/\\1\\s*>/.source + // eslint-disable-line regexp/strict\n\t\t\t'|' +\n\t\t\t/</.source +\n\t\t\ttagContent +\n\t\t\t')';\n\n\t\t// Now for the actual language definition(s):\n\t\t//\n\t\t// Razor as a language has 2 parts:\n\t\t//  1) CSHTML: A markup-like language that has been extended with inline C# code expressions and blocks.\n\t\t//  2) C#+HTML: A variant of C# that can contain CSHTML tags as expressions.\n\t\t//\n\t\t// In the below code, both CSHTML and C#+HTML will be create as separate language definitions that reference each\n\t\t// other. However, only CSHTML will be exported via `Prism.languages`.\n\n\t\tconst csharpWithHtml = extend('csharp', {});\n\t\tinsertBefore(csharpWithHtml, 'string', {\n\t\t\t'html': {\n\t\t\t\tpattern: RegExp(tagRegion),\n\t\t\t\tgreedy: true,\n\t\t\t\tinside: 'cshtml',\n\t\t\t},\n\t\t});\n\n\t\tconst cs = {\n\t\t\tpattern: /\\S[\\s\\S]*/,\n\t\t\talias: 'language-csharp',\n\t\t\tinside: csharpWithHtml,\n\t\t};\n\n\t\tconst inlineValue = {\n\t\t\tpattern: RegExp(/(^|[^@])/.source + inlineCs),\n\t\t\tlookbehind: true,\n\t\t\tgreedy: true,\n\t\t\talias: 'variable',\n\t\t\tinside: {\n\t\t\t\t'keyword': /^@/,\n\t\t\t\t'csharp': cs,\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\t$merge: {\n\t\t\t\t'tag': {\n\t\t\t\t\tpattern: RegExp(/<\\/?/.source + tagContent),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'attr-value': {\n\t\t\t\t\t\t\tpattern: RegExp(/=\\s*/.source + tagAttrValue),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t$insertBefore: {\n\t\t\t\t'tag/attr-value/punctuation': {\n\t\t\t\t\t'value': inlineValue,\n\t\t\t\t},\n\t\t\t\t'prolog': {\n\t\t\t\t\t'razor-comment': {\n\t\t\t\t\t\tpattern: /@\\*[\\s\\S]*?\\*@/,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\talias: 'comment',\n\t\t\t\t\t},\n\n\t\t\t\t\t'block': {\n\t\t\t\t\t\tpattern: RegExp(\n\t\t\t\t\t\t\t/(^|[^@])@/.source +\n\t\t\t\t\t\t\t\t'(?:' +\n\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t// @{ ... }\n\t\t\t\t\t\t\t\t\tcurly,\n\t\t\t\t\t\t\t\t\t// @code{ ... }\n\t\t\t\t\t\t\t\t\t/(?:code|functions)\\s*/.source + curly,\n\t\t\t\t\t\t\t\t\t// @for (...) { ... }\n\t\t\t\t\t\t\t\t\t/(?:for|foreach|lock|switch|using|while)\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tround +\n\t\t\t\t\t\t\t\t\t\t/\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly,\n\t\t\t\t\t\t\t\t\t// @do { ... } while (...);\n\t\t\t\t\t\t\t\t\t/do\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly +\n\t\t\t\t\t\t\t\t\t\t/\\s*while\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tround +\n\t\t\t\t\t\t\t\t\t\t/(?:\\s*;)?/.source,\n\t\t\t\t\t\t\t\t\t// @try { ... } catch (...) { ... } finally { ... }\n\t\t\t\t\t\t\t\t\t/try\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly +\n\t\t\t\t\t\t\t\t\t\t/\\s*catch\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tround +\n\t\t\t\t\t\t\t\t\t\t/\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly +\n\t\t\t\t\t\t\t\t\t\t/\\s*finally\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly,\n\t\t\t\t\t\t\t\t\t// @if (...) {...} else if (...) {...} else {...}\n\t\t\t\t\t\t\t\t\t/if\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tround +\n\t\t\t\t\t\t\t\t\t\t/\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly +\n\t\t\t\t\t\t\t\t\t\t'(?:' +\n\t\t\t\t\t\t\t\t\t\t/\\s*else/.source +\n\t\t\t\t\t\t\t\t\t\t'(?:' +\n\t\t\t\t\t\t\t\t\t\t/\\s+if\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tround +\n\t\t\t\t\t\t\t\t\t\t')?' +\n\t\t\t\t\t\t\t\t\t\t/\\s*/.source +\n\t\t\t\t\t\t\t\t\t\tcurly +\n\t\t\t\t\t\t\t\t\t\t')*',\n\t\t\t\t\t\t\t\t\t// @helper Ident(params) { ... }\n\t\t\t\t\t\t\t\t\t/helper\\s+\\w+\\s*/.source + round + /\\s*/.source + curly,\n\t\t\t\t\t\t\t\t].join('|') +\n\t\t\t\t\t\t\t\t')'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\tinside: {\n\t\t\t\t\t\t\t'keyword': /^@\\w*/,\n\t\t\t\t\t\t\t'csharp': cs,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\n\t\t\t\t\t'directive': {\n\t\t\t\t\t\tpattern:\n\t\t\t\t\t\t\t/^([ \\t]*)@(?:addTagHelper|attribute|implements|inherits|inject|layout|model|namespace|page|preservewhitespace|removeTagHelper|section|tagHelperPrefix|using)(?=\\s).*/m,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\tgreedy: true,\n\t\t\t\t\t\tinside: {\n\t\t\t\t\t\t\t'keyword': /^@\\w+/,\n\t\t\t\t\t\t\t'csharp': cs,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\n\t\t\t\t\t'value': inlineValue,\n\n\t\t\t\t\t'delegate-operator': {\n\t\t\t\t\t\tpattern: /(^|[^@])@(?=<)/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'operator',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t},\n};\n"],"names":["cshtml","id","base","markup","require","csharp","alias","grammar","extend","nested","pattern","depthLog2","i","replace","round","square","curly","inlineCs","tagAttrValue","tagAttrs","tagContent","tagRegion","csharpWithHtml","insertBefore","html","RegExp","greedy","inside","cs","inlineValue","lookbehind","keyword","$merge","tag","$insertBefore","value","prolog","block","join","directive"],"mappings":"qMAKA,IAAeA,EAAA,CACdC,GAAI,SACJC,KAAMC,EACNC,QAASC,EACTC,MAAO,QACP,OAAAC,EAASC,OAAEA,IAiBV,SAASC,EAAQC,EAASC,GACzB,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAWC,IAC9BF,EAAUA,EAAQG,QAAQ,WAAW,IAAM,MAAQH,EAAU,MAE9D,OAAOA,EACLG,QAAQ,UAAW,aACnBA,QAAQ,SAAU,qJAClBA,QAAQ,aAAc,2DAC3B,CAEE,MAAMC,EAAQL,EAAO,+CAAoD,GACnEM,EAASN,EAAO,mDAAsD,GACtEO,EAAQP,EAAO,+CAAoD,GAGnEQ,EACL,4CAKAH,EALA,0BAHaL,EAAO,qCAA4C,GAehE,KACAK,EACA,IACAC,EAfA,2BAgCKG,EACL,mFAFoDD,EAEpD,oBAQKE,EACL,qEAAuEN,QACtE,iBACAK,GAEIE,EAAa,uBAA+BD,EAAW,UACvDE,EACL,6BAGAF,EAHA,6BAWCC,EACA,IAEAX,EAEC,OACCU,EADD,6BASEC,EATF,sBAeA,GA/BF,iBAsCAA,EACA,IAWKE,EAAiBd,EAAO,SAAU,IACxCe,EAAaD,EAAgB,SAAU,CACtCE,KAAQ,CACPd,QAASe,OAAOJ,GAChBK,QAAQ,EACRC,OAAQ,YAIV,MAAMC,EAAK,CACVlB,QAAS,YACTJ,MAAO,kBACPqB,OAAQL,GAGHO,EAAc,CACnBnB,QAASe,OAAO,WAAoBR,GACpCa,YAAY,EACZJ,QAAQ,EACRpB,MAAO,WACPqB,OAAQ,CACPI,QAAW,KACX1B,OAAUuB,IAIZ,MAAO,CACNI,OAAQ,CACPC,IAAO,CACNvB,QAASe,OAAO,MAAgBL,GAChCO,OAAQ,CACP,aAAc,CACbjB,QAASe,OAAO,QAAgBP,OAKpCgB,cAAe,CACd,6BAA8B,CAC7BC,MAASN,GAEVO,OAAU,CACT,gBAAiB,CAChB1B,QAAS,iBACTgB,QAAQ,EACRpB,MAAO,WAGR+B,MAAS,CACR3B,QAASe,OACR,eAEC,CAECT,EAEA,yBAAiCA,EAEjC,8CACCF,EACA,OACAE,EAED,SACCA,EACA,gBACAF,EACA,aAED,UACCE,EACA,gBACAF,EACA,OACAE,EACA,kBACAA,EAED,SACCF,EACA,OACAE,EAHD,2BAQCF,EARD,SAWCE,EACA,KAED,qBAA2BF,EAAQ,OAAeE,GACjDsB,KAAK,KACP,KAEFR,YAAY,EACZJ,QAAQ,EACRC,OAAQ,CACPI,QAAW,QACX1B,OAAUuB,IAIZW,UAAa,CACZ7B,QACC,wKACDoB,YAAY,EACZJ,QAAQ,EACRC,OAAQ,CACPI,QAAW,QACX1B,OAAUuB,IAIZO,MAASN,EAET,oBAAqB,CACpBnB,QAAS,iBACToB,YAAY,EACZxB,MAAO,cAKX"}