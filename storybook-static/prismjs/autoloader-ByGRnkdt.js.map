{"version":3,"file":"autoloader-ByGRnkdt.js","sources":["../src/shared/meta/alias-data.js","../src/plugins/autoloader/autoloader.js"],"sourcesContent":["/**\n * A record mapping the aliases of all known components to their respective ids.\n *\n * Note: This record is automatically generated by the build process.\n */\nconst knownAliases = /* aliases_placeholder[ */ {}; /* ] */\n\n/**\n * @param {string} name\n * @returns {string}\n */\nexport function resolveAlias (name) {\n\treturn knownAliases[name] || name;\n}\n","import prism from '../../global.js';\nimport { getParentPre } from '../../shared/dom-util.js';\nimport { resolveAlias } from '../../shared/meta/alias-data.js';\nimport { toArray } from '../../util/iterables.js';\n\nfunction getDefaultSrcPath () {\n\tif (typeof document !== 'undefined') {\n\t\tconst script = /** @type {HTMLScriptElement | null} */ (document.currentScript);\n\t\tif (script) {\n\t\t\tconst autoloaderFile =\n\t\t\t\t/\\bplugins\\/autoloader\\/autoloader\\.(?:min\\.)?js(?:\\?[^\\r\\n/]*)?$/i;\n\t\t\tconst prismFile = /(^|\\/)[\\w-]+\\.(?:min\\.)?m?js(?:\\?[^\\r\\n/]*)?$/i;\n\n\t\t\tconst autoloaderPath = script.getAttribute('data-autoloader-path');\n\t\t\tif (autoloaderPath != null) {\n\t\t\t\t// data-autoloader-path is set, so just use it\n\t\t\t\treturn autoloaderPath.trim().replace(/\\/?$/, '/');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst src = script.src;\n\t\t\t\tif (autoloaderFile.test(src)) {\n\t\t\t\t\t// the script is the original autoloader script in the usual Prism project structure\n\t\t\t\t\treturn src.replace(autoloaderFile, '/');\n\t\t\t\t}\n\t\t\t\telse if (prismFile.test(src)) {\n\t\t\t\t\t// the script is part of a bundle like a custom prism.js from the download page\n\t\t\t\t\treturn src.replace(prismFile, '$1/');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn './';\n}\n\n/**\n * @param {string} dir\n * @param {string} file\n * @returns {string}\n */\nfunction pathJoin (dir, file) {\n\treturn dir.replace(/\\/$/, '') + '/' + file;\n}\n\n/** @type {Set<string>} */\nconst ignoredLanguages = new Set(['none']);\n\n/**\n * @param {Prism} Prism The Prism instance\n * @param {string} name The name of the language\n */\nfunction isLoaded (Prism, name) {\n\t// resolve alias\n\tconst id = Prism.languageRegistry.resolveRef(name).id;\n\treturn Prism.languageRegistry.has(id) || ignoredLanguages.has(id);\n}\n\nexport class Autoloader {\n\tsrcPath = getDefaultSrcPath();\n\n\t/**\n\t * @type {Map<string, Promise<any>>}\n\t */\n\t_importCache = new Map();\n\n\t/**\n\t * @type {Prism}\n\t */\n\tPrism;\n\n\t/**\n\t * @param {Prism} Prism\n\t */\n\tconstructor (Prism) {\n\t\tthis.Prism = Prism;\n\t}\n\n\t/**\n\t * Loads all given languages concurrently.\n\t *\n\t * @param {string | string[]} languages\n\t * @returns {Promise<void>}\n\t */\n\tasync loadLanguages (languages) {\n\t\tconst toLoad = toArray(languages)\n\t\t\t.map(resolveAlias)\n\t\t\t.filter(id => !isLoaded(this.Prism, id));\n\n\t\tawait Promise.all(\n\t\t\ttoLoad.map(id => {\n\t\t\t\tconst path = pathJoin(this.srcPath, `languages/${id}.js`);\n\n\t\t\t\tlet promise = this._importCache.get(path);\n\t\t\t\tif (promise === undefined) {\n\t\t\t\t\tpromise = import(path).then(exports => {\n\t\t\t\t\t\t/** @type {import('../../types.d.ts').LanguageProto} */\n\t\t\t\t\t\tconst proto = exports.default;\n\t\t\t\t\t\tthis.Prism.languageRegistry.add(proto);\n\t\t\t\t\t});\n\t\t\t\t\tthis._importCache.set(path, promise);\n\t\t\t\t}\n\t\t\t\treturn promise;\n\t\t\t})\n\t\t);\n\t}\n\n\t/**\n\t * Loads all given languages concurrently.\n\t *\n\t * This function simply invokes {@link Autoloader#loadLanguages} and logs errors to `console.error`.\n\t *\n\t * @param {string | string[]} languages\n\t * @returns {void}\n\t */\n\tpreloadLanguages (languages) {\n\t\tthis.loadLanguages(languages).catch(reason => {\n\t\t\tconsole.error(\n\t\t\t\t`Failed to preload languages (${toArray(languages).join(', ')}): ${String(reason)}`\n\t\t\t);\n\t\t});\n\t}\n}\n\n/** @type {import('../../types.d.ts').PluginProto<'autoloader'>} */\nconst Self = {\n\tid: 'autoloader',\n\tplugin (Prism) {\n\t\treturn new Autoloader(Prism);\n\t},\n\teffect (Prism) {\n\t\t/**\n\t\t * Returns all additional dependencies of the given element defined by the `data-dependencies` attribute.\n\t\t *\n\t\t * @param {Element} element\n\t\t * @returns {string[]}\n\t\t */\n\t\tfunction getDependencies (element) {\n\t\t\tlet deps = element.getAttribute('data-dependencies')?.trim();\n\t\t\tif (!deps) {\n\t\t\t\tconst parent = getParentPre(element);\n\t\t\t\tif (parent) {\n\t\t\t\t\tdeps = parent.getAttribute('data-dependencies')?.trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn deps ? deps.split(/\\s*,\\s*/) : [];\n\t\t}\n\n\t\t/**\n\t\t * Maps the given name to a list of components that have to be loaded.\n\t\t *\n\t\t * @param {string} name\n\t\t * @returns {string[]}\n\t\t */\n\t\tfunction mapDependency (name) {\n\t\t\tif (!name || ignoredLanguages.has(name)) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\telse if (/^diff-./i.test(name)) {\n\t\t\t\t// the \"diff-xxxx\" format is used by the Diff Highlight plugin\n\t\t\t\treturn ['diff', name.slice('diff-'.length)];\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn [name];\n\t\t\t}\n\t\t}\n\n\t\treturn Prism.hooks.add('complete', ({ element, language }) => {\n\t\t\tif (!language || ignoredLanguages.has(language)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet deps = mapDependency(language);\n\t\t\tfor (const name of getDependencies(element)) {\n\t\t\t\tdeps.push(...mapDependency(name));\n\t\t\t}\n\n\t\t\tdeps = deps.filter(name => !isLoaded(Prism, name));\n\t\t\tif (deps.length === 0) {\n\t\t\t\t// all dependencies are already loaded\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/** @type {Autoloader} */\n\t\t\tconst autoloader = Prism.pluginRegistry.peek(Self)?.plugin;\n\t\t\tautoloader.loadLanguages(deps).then(\n\t\t\t\t() => Prism.highlightElement(element),\n\t\t\t\treason => {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t`Failed to load languages (${deps.join(', ')}): ${String(reason)}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n};\n\nexport default Self;\n\nprism.pluginRegistry.add(Self);\n\n/**\n * @typedef {import('../../core.js').Prism} Prism\n */\n"],"names":["knownAliases","g4","ino","art","adoc","avs","avdl","gawk","sh","shell","shortcode","rbnf","oscript","cfc","cilk","coffee","conc","cs","dotnet","razor","jinja2","dockerfile","gv","eta","xlsx","xls","po","gamemakerlanguage","gni","hbs","mustache","hs","idr","gitignore","hgignore","npmignore","js","webmanifest","kt","kts","kum","tex","context","ly","ld","emacs","elisp","md","html","svg","mathml","moon","n4jsd","nani","objc","qasm","objectpascal","px","pcode","text","txt","plaintext","plantuml","pq","mscript","pbfasm","purs","py","qs","rkt","rpy","res","robot","rb","shellsession","smlnj","sol","sln","rq","sclang","t4","trickle","troy","trig","ts","tsconfig","uscript","uc","url","vb","vba","webidl","mathematica","nb","wl","xeoracube","ssml","atom","rss","yml","resolveAlias","name","ignoredLanguages","Set","isLoaded","Prism","id","languageRegistry","resolveRef","has","Autoloader","srcPath","document","script","autoloaderFile","prismFile","autoloaderPath","getAttribute","trim","replace","src","test","getDefaultSrcPath","_importCache","Map","constructor","this","loadLanguages","languages","toLoad","toArray","map","filter","Promise","all","path","file","promise","get","undefined","import","then","exports","proto","default","add","set","preloadLanguages","catch","reason","console","error","join","String","Self","plugin","effect","mapDependency","slice","hooks","element","language","deps","parent","getParentPre","split","getDependencies","push","length","autoloader","pluginRegistry","peek","highlightElement","prism"],"mappings":"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"}