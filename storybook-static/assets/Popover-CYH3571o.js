import{j as m}from"./jsx-runtime-DwZrPTBh.js";import{r as x,R as y}from"./iframe-DeqXgmUH.js";import{r as D}from"./index-Bg2guSoB.js";import{c as p}from"./cn-fNskMoFt.js";const M=({isOpen:s,anchorEl:h,anchorRef:w,onClose:b,children:E,placement:d="bottom",align:a="center",offset:u=8,showArrow:L=!0,className:j,trapFocus:g=!0})=>{const f=x.useRef(null),[v,k]=x.useState(null),R=()=>{const r=h??w?.current;return r?r.getBoundingClientRect():null};return x.useLayoutEffect(()=>{if(!s)return;const r=()=>{const c=R(),o=f.current;if(!o)return;const e=o.getBoundingClientRect(),t=c??{top:window.innerHeight/2,left:window.innerWidth/2,width:0,height:0,right:window.innerWidth/2,bottom:window.innerHeight/2};let i=0,n=0;d==="bottom"?(i=t.bottom+u,a==="start"?n=t.left:a==="center"?n=t.left+t.width/2-e.width/2:n=t.right-e.width):d==="top"?(i=t.top-e.height-u,a==="start"?n=t.left:a==="center"?n=t.left+t.width/2-e.width/2:n=t.right-e.width):d==="left"?(n=t.left-e.width-u,a==="start"?i=t.top:a==="center"?i=t.top+t.height/2-e.height/2:i=t.bottom-e.height):(n=t.right+u,a==="start"?i=t.top:a==="center"?i=t.top+t.height/2-e.height/2:i=t.bottom-e.height),i=Math.max(8,Math.min(i,window.innerHeight-e.height-8)),n=Math.max(8,Math.min(n,window.innerWidth-e.width-8)),k({top:i,left:n})};r();const l=new ResizeObserver(r);return l.observe(document.body),window.addEventListener("scroll",r,!0),window.addEventListener("resize",r),()=>{l.disconnect(),window.removeEventListener("scroll",r,!0),window.removeEventListener("resize",r)}},[s,h,w,d,a,u]),y.useEffect(()=>{if(!s)return;const r=c=>{const o=c.target,e=f.current,t=h??w?.current;e&&!e.contains(o)&&t&&!t.contains(o)&&b?.()},l=c=>{c.key==="Escape"&&b?.()};return document.addEventListener("mousedown",r),document.addEventListener("keydown",l),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",l)}},[s,h,w,b]),s?(y.useEffect(()=>{!s||!g||requestAnimationFrame(()=>{f.current?.focus()})},[s,v,g]),y.useEffect(()=>{if(!s||!g)return;const r=f.current;if(!r)return;const l=()=>{if(!r)return[];const o=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'];return Array.from(r.querySelectorAll(o.join(","))).filter(e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))},c=o=>{if(o.key!=="Tab")return;const e=l();if(e.length===0){o.preventDefault(),r.focus();return}const t=e[0],i=e[e.length-1],n=document.activeElement;!o.shiftKey&&n===i?(o.preventDefault(),t.focus()):o.shiftKey&&(n===t||n===r)&&(o.preventDefault(),i.focus())};return r.addEventListener("keydown",c),()=>r.removeEventListener("keydown",c)},[s]),D.createPortal(m.jsx("div",{"aria-hidden":!1,children:m.jsxs("div",{ref:f,role:"dialog",tabIndex:-1,"aria-modal":!1,className:p("bg-white rounded shadow-md ring-1 ring-black/5 p-2",j),style:{position:"absolute",top:v?.top??0,left:v?.left??0,zIndex:60},children:[L&&m.jsx("div",{"data-placement":d,className:p("absolute w-3 h-3 bg-white rotate-45 shadow-sm",d==="top"&&"-translate-y-1 bottom-0 left-1/2 -translate-x-1/2",d==="bottom"&&"-translate-y-1 top-0 left-1/2 -translate-x-1/2",d==="left"&&"right-0 top-1/2 -translate-y-1/2 -translate-x-1",d==="right"&&"left-0 top-1/2 -translate-y-1/2 translate-x-1")}),m.jsx("div",{children:E})]})}),document.body)):null};export{M as P};
