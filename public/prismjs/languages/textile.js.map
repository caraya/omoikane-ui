{"version":3,"file":"textile.js","sources":["../../src/languages/textile.js"],"sourcesContent":["import markup from './markup.js';\n\n/** @type {import('../types.d.ts').LanguageProto<'textile'>} */\nexport default {\n\tid: 'textile',\n\tbase: markup,\n\tgrammar ({ base }) {\n\t\t// We don't allow for pipes inside parentheses\n\t\t// to not break table pattern |(. foo |). bar |\n\t\tconst modifierRegex = /\\([^|()\\n]+\\)|\\[[^\\]\\n]+\\]|\\{[^}\\n]+\\}/.source;\n\t\t// Opening and closing parentheses which are not a modifier\n\t\t// This pattern is necessary to prevent exponential backtracking\n\t\tconst parenthesesRegex = /\\)|\\((?![^|()\\n]+\\))/.source;\n\n\t\t/**\n\t\t *\n\t\t * @param {string} source\n\t\t * @param {string} [flags]\n\t\t * @returns {RegExp}\n\t\t */\n\t\tfunction withModifier (source, flags) {\n\t\t\treturn RegExp(\n\t\t\t\tsource\n\t\t\t\t\t.replace(/<MOD>/g, () => '(?:' + modifierRegex + ')')\n\t\t\t\t\t.replace(/<PAR>/g, () => '(?:' + parenthesesRegex + ')'),\n\t\t\t\tflags || ''\n\t\t\t);\n\t\t}\n\n\t\tconst modifierTokens = {\n\t\t\t'css': {\n\t\t\t\tpattern: /\\{[^{}]+\\}/,\n\t\t\t\tinside: 'css',\n\t\t\t},\n\t\t\t'class-id': {\n\t\t\t\tpattern: /(\\()[^()]+(?=\\))/,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'attr-value',\n\t\t\t},\n\t\t\t'lang': {\n\t\t\t\tpattern: /(\\[)[^\\[\\]]+(?=\\])/,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'attr-value',\n\t\t\t},\n\t\t\t// Anything else is punctuation (the first pattern is for row/col spans inside tables)\n\t\t\t'punctuation': /[\\\\\\/]\\d+|\\S/,\n\t\t};\n\n\t\tconst phrase = {\n\t\t\tpattern: /(^|\\r|\\n)\\S[\\s\\S]*?(?=$|\\r?\\n\\r?\\n|\\r\\r)/,\n\t\t\tlookbehind: true,\n\t\t\tinside: {\n\t\t\t\t// h1. Header 1\n\t\t\t\t'block-tag': {\n\t\t\t\t\tpattern: withModifier(/^[a-z]\\w*(?:<MOD>|<PAR>|[<>=])*\\./.source),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\tpattern: withModifier(/(^[a-z]\\w*)(?:<MOD>|<PAR>|[<>=])+(?=\\.)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'tag': /^[a-z]\\w*/,\n\t\t\t\t\t\t'punctuation': /\\.$/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// # List item\n\t\t\t\t// * List item\n\t\t\t\t'list': {\n\t\t\t\t\tpattern: withModifier(/^[*#]+<MOD>*\\s+\\S.*/.source, 'm'),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\tpattern: withModifier(/(^[*#]+)<MOD>+/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /^[*#]+/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// | cell | cell | cell |\n\t\t\t\t'table': {\n\t\t\t\t\t// Modifiers can be applied to the row: {color:red}.|1|2|3|\n\t\t\t\t\t// or the cell: |{color:red}.1|2|3|\n\t\t\t\t\tpattern: withModifier(\n\t\t\t\t\t\t/^(?:(?:<MOD>|<PAR>|[<>=^~])+\\.\\s*)?(?:\\|(?:(?:<MOD>|<PAR>|[<>=^~_]|[\\\\/]\\d+)+\\.|(?!(?:<MOD>|<PAR>|[<>=^~_]|[\\\\/]\\d+)+\\.))[^|]*)+\\|/\n\t\t\t\t\t\t\t.source,\n\t\t\t\t\t\t'm'\n\t\t\t\t\t),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\t// Modifiers for rows after the first one are\n\t\t\t\t\t\t\t// preceded by a pipe and a line feed\n\t\t\t\t\t\t\tpattern: withModifier(\n\t\t\t\t\t\t\t\t/(^|\\|(?:\\r?\\n|\\r)?)(?:<MOD>|<PAR>|[<>=^~_]|[\\\\/]\\d+)+(?=\\.)/.source\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /\\||^\\./,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t'inline': {\n\t\t\t\t\tpattern: withModifier(\n\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t/(^|[^a-zA-Z\\d])(\\*\\*|__|\\?\\?|[*_%@+\\-^~])<MOD>*.+?\\2(?![a-zA-Z\\d])/.source\n\t\t\t\t\t),\n\t\t\t\t\tlookbehind: true,\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t// Note: superscripts and subscripts are not handled specifically\n\n\t\t\t\t\t\t// *bold*, **bold**\n\t\t\t\t\t\t'bold': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^(\\*\\*?)<MOD>*).+?(?=\\2)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: /** @type {GrammarToken['inside']} */ (null),\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// _italic_, __italic__\n\t\t\t\t\t\t'italic': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^(__?)<MOD>*).+?(?=\\2)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: /** @type {GrammarToken['inside']} */ (null),\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// ??cite??\n\t\t\t\t\t\t'cite': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^\\?\\?<MOD>*).+?(?=\\?\\?)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: 'string',\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// @code@\n\t\t\t\t\t\t'code': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^@<MOD>*).+?(?=@)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: 'keyword',\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// +inserted+\n\t\t\t\t\t\t'inserted': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^\\+<MOD>*).+?(?=\\+)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: /** @type {GrammarToken['inside']} */ (null),\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// -deleted-\n\t\t\t\t\t\t'deleted': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^-<MOD>*).+?(?=-)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: /** @type {GrammarToken['inside']} */ (null),\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t// %span%\n\t\t\t\t\t\t'span': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^%<MOD>*).+?(?=%)/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: /** @type {GrammarToken['inside']} */ (null),\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\tpattern: withModifier(/(^\\*\\*|__|\\?\\?|[*_%@+\\-^~])<MOD>+/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /[*_%?@+\\-^~]+/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// [alias]http://example.com\n\t\t\t\t'link-ref': {\n\t\t\t\t\tpattern: /^\\[[^\\]]+\\]\\S+$/m,\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'string': {\n\t\t\t\t\t\t\tpattern: /(^\\[)[^\\]]+(?=\\])/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'url': {\n\t\t\t\t\t\t\tpattern: /(^\\])\\S+$/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /[\\[\\]]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// \"text\":http://example.com\n\t\t\t\t// \"text\":link-ref\n\t\t\t\t'link': {\n\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\tpattern: withModifier(/\"<MOD>*[^\"]+\":.+?(?=[^\\w/]?(?:\\s|$))/.source),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'text': {\n\t\t\t\t\t\t\t// eslint-disable-next-line regexp/no-super-linear-backtracking\n\t\t\t\t\t\t\tpattern: withModifier(/(^\"<MOD>*)[^\"]+(?=\")/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\tpattern: withModifier(/(^\")<MOD>+/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'url': {\n\t\t\t\t\t\t\tpattern: /(:).+/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /[\":]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// !image.jpg!\n\t\t\t\t// !image.jpg(Title)!:http://example.com\n\t\t\t\t'image': {\n\t\t\t\t\tpattern: withModifier(\n\t\t\t\t\t\t/!(?:<MOD>|<PAR>|[<>=])*(?![<>=])[^!\\s()]+(?:\\([^)]+\\))?!(?::.+?(?=[^\\w/]?(?:\\s|$)))?/\n\t\t\t\t\t\t\t.source\n\t\t\t\t\t),\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'source': {\n\t\t\t\t\t\t\tpattern: withModifier(\n\t\t\t\t\t\t\t\t/(^!(?:<MOD>|<PAR>|[<>=])*)(?![<>=])[^!\\s()]+(?:\\([^)]+\\))?(?=!)/\n\t\t\t\t\t\t\t\t\t.source\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: 'url',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'modifier': {\n\t\t\t\t\t\t\tpattern: withModifier(/(^!)(?:<MOD>|<PAR>|[<>=])+/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\tinside: modifierTokens,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'url': {\n\t\t\t\t\t\t\tpattern: /(:).+/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /[!:]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// Footnote[1]\n\t\t\t\t'footnote': {\n\t\t\t\t\tpattern: /\\b\\[\\d+\\]/,\n\t\t\t\t\talias: 'comment',\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'punctuation': /\\[|\\]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// CSS(Cascading Style Sheet)\n\t\t\t\t'acronym': {\n\t\t\t\t\tpattern: /\\b[A-Z\\d]+\\([^)]+\\)/,\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'comment': {\n\t\t\t\t\t\t\tpattern: /(\\()[^()]+(?=\\))/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'punctuation': /[()]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// Prism(C)\n\t\t\t\t'mark': {\n\t\t\t\t\tpattern: /\\b\\((?:C|R|TM)\\)/,\n\t\t\t\t\talias: 'comment',\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'punctuation': /[()]/,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst phraseInside = phrase.inside;\n\t\tconst nestedPatterns = {\n\t\t\t'inline': phraseInside['inline'],\n\t\t\t'link': phraseInside['link'],\n\t\t\t'image': phraseInside['image'],\n\t\t\t'footnote': phraseInside['footnote'],\n\t\t\t'acronym': phraseInside['acronym'],\n\t\t\t'mark': phraseInside['mark'],\n\t\t};\n\n\t\t// Allow some nesting\n\t\tconst phraseInlineInside = phraseInside['inline'].inside;\n\t\tphraseInlineInside['bold'].inside = nestedPatterns;\n\t\tphraseInlineInside['italic'].inside = nestedPatterns;\n\t\tphraseInlineInside['inserted'].inside = nestedPatterns;\n\t\tphraseInlineInside['deleted'].inside = nestedPatterns;\n\t\tphraseInlineInside['span'].inside = nestedPatterns;\n\n\t\t// Allow some styles inside table cells\n\t\tObject.assign(phraseInside['table'].inside, nestedPatterns);\n\n\t\t// Only allow alpha-numeric HTML tags, not XML tags\n\t\tconst tag = /** @type {GrammarToken} */ (base.tag);\n\t\ttag.pattern =\n\t\t\t/<\\/?(?!\\d)[a-z0-9]+(?:\\s+[^\\s>\\/=]+(?:=(?:(\"|')(?:\\\\[\\s\\S]|(?!\\1)[^\\\\])*\\1|[^\\s'\">=]+))?)*\\s*\\/?>/i;\n\n\t\treturn {\n\t\t\t'phrase': phrase,\n\t\t};\n\t},\n};\n\n/**\n * @typedef {import('../types.d.ts').GrammarToken} GrammarToken\n */\n"],"names":["textile","id","base","markup","grammar","withModifier","source","flags","RegExp","replace","modifierTokens","css","pattern","inside","lookbehind","alias","lang","punctuation","phrase","modifier","tag","list","table","inline","bold","italic","cite","code","inserted","deleted","span","string","url","link","text","image","footnote","acronym","comment","mark","phraseInside","nestedPatterns","phraseInlineInside","Object","assign"],"mappings":"4EAGA,IAAeA,EAAA,CACdC,GAAI,UACJC,KAAMC,EACN,OAAAC,EAASF,KAAEA,IAcV,SAASG,EAAcC,EAAQC,GAC9B,OAAOC,OACNF,EACEG,QAAQ,UAAU,IAAM,sDACxBA,QAAQ,UAAU,IAAM,gCAC1BF,GAAS,GAEb,CAEE,MAAMG,EAAiB,CACtBC,IAAO,CACNC,QAAS,aACTC,OAAQ,OAET,WAAY,CACXD,QAAS,mBACTE,YAAY,EACZC,MAAO,cAERC,KAAQ,CACPJ,QAAS,qBACTE,YAAY,EACZC,MAAO,cAGRE,YAAe,gBAGVC,EAAS,CACdN,QAAS,2CACTE,YAAY,EACZD,OAAQ,CAEP,YAAa,CACZD,QAASP,EAAa,uCACtBQ,OAAQ,CACPM,SAAY,CACXP,QAASP,EAAa,6CACtBS,YAAY,EACZD,OAAQH,GAETU,IAAO,YACPH,YAAe,QAMjBI,KAAQ,CACPT,QAASP,EAAa,wBAA8B,KACpDQ,OAAQ,CACPM,SAAY,CACXP,QAASP,EAAa,kBACtBS,YAAY,EACZD,OAAQH,GAETO,YAAe,WAKjBK,MAAS,CAGRV,QAASP,EACR,iJAEA,KAEDQ,OAAQ,CACPM,SAAY,CAGXP,QAASP,EACR,oEAEDS,YAAY,EACZD,OAAQH,GAETO,YAAe,WAIjBM,OAAU,CACTX,QAASP,EAER,8EAEDS,YAAY,EACZD,OAAQ,CAIPW,KAAQ,CAEPZ,QAASP,EAAa,gCACtBS,YAAY,EACZD,OAA+C,MAIhDY,OAAU,CAETb,QAASP,EAAa,4BACtBS,YAAY,EACZD,OAA+C,MAIhDa,KAAQ,CAEPd,QAASP,EAAa,gCACtBS,YAAY,EACZC,MAAO,UAIRY,KAAQ,CAEPf,QAASP,EAAa,sBACtBS,YAAY,EACZC,MAAO,WAIRa,SAAY,CAEXhB,QAASP,EAAa,0BACtBS,YAAY,EACZD,OAA+C,MAIhDgB,QAAW,CAEVjB,QAASP,EAAa,sBACtBS,YAAY,EACZD,OAA+C,MAIhDiB,KAAQ,CAEPlB,QAASP,EAAa,sBACtBS,YAAY,EACZD,OAA+C,MAGhDM,SAAY,CACXP,QAASP,EAAa,0CACtBS,YAAY,EACZD,OAAQH,GAETO,YAAe,kBAKjB,WAAY,CACXL,QAAS,mBACTC,OAAQ,CACPkB,OAAU,CACTnB,QAAS,oBACTE,YAAY,GAEbkB,IAAO,CACNpB,QAAS,YACTE,YAAY,GAEbG,YAAe,WAMjBgB,KAAQ,CAEPrB,QAASP,EAAa,0CACtBQ,OAAQ,CACPqB,KAAQ,CAEPtB,QAASP,EAAa,wBACtBS,YAAY,GAEbK,SAAY,CACXP,QAASP,EAAa,cACtBS,YAAY,EACZD,OAAQH,GAETsB,IAAO,CACNpB,QAAS,QACTE,YAAY,GAEbG,YAAe,SAMjBkB,MAAS,CACRvB,QAASP,EACR,6FAGDQ,OAAQ,CACPP,OAAU,CACTM,QAASP,EACR,sEAGDS,YAAY,EACZC,MAAO,OAERI,SAAY,CACXP,QAASP,EAAa,8BACtBS,YAAY,EACZD,OAAQH,GAETsB,IAAO,CACNpB,QAAS,QACTE,YAAY,GAEbG,YAAe,SAKjBmB,SAAY,CACXxB,QAAS,YACTG,MAAO,UACPF,OAAQ,CACPI,YAAe,UAKjBoB,QAAW,CACVzB,QAAS,sBACTC,OAAQ,CACPyB,QAAW,CACV1B,QAAS,mBACTE,YAAY,GAEbG,YAAe,SAKjBsB,KAAQ,CACP3B,QAAS,mBACTG,MAAO,UACPF,OAAQ,CACPI,YAAe,WAMbuB,EAAetB,EAAOL,OACtB4B,EAAiB,CACtBlB,OAAUiB,EAAqB,OAC/BP,KAAQO,EAAmB,KAC3BL,MAASK,EAAoB,MAC7BJ,SAAYI,EAAuB,SACnCH,QAAWG,EAAsB,QACjCD,KAAQC,EAAmB,MAItBE,EAAqBF,EAAqB,OAAE3B,OAelD,OAdA6B,EAAyB,KAAE7B,OAAS4B,EACpCC,EAA2B,OAAE7B,OAAS4B,EACtCC,EAA6B,SAAE7B,OAAS4B,EACxCC,EAA4B,QAAE7B,OAAS4B,EACvCC,EAAyB,KAAE7B,OAAS4B,EAGpCE,OAAOC,OAAOJ,EAAoB,MAAE3B,OAAQ4B,GAGHvC,EAAQ,IAC7CU,QACH,qGAEM,CACNM,OAAUA,EAEX"}