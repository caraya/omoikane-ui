{"version":3,"file":"ftl.js","sources":["../../src/languages/ftl.js"],"sourcesContent":["import { embeddedIn } from '../shared/languages/templating.js';\nimport markup from './markup.js';\n\n/** @type {import('../types.d.ts').LanguageProto<'ftl'>} */\nexport default {\n\tid: 'ftl',\n\trequire: markup,\n\tgrammar () {\n\t\t// https://freemarker.apache.org/docs/dgui_template_exp.html\n\n\t\t// FTL expression with 4 levels of nesting supported\n\t\tlet FTL_EXPR =\n\t\t\t/[^<()\"']|\\((?:<expr>)*\\)|<(?!#--)|<#--(?:[^-]|-(?!->))*-->|\"(?:[^\\\\\"]|\\\\.)*\"|'(?:[^\\\\']|\\\\.)*'/\n\t\t\t\t.source;\n\t\tfor (let i = 0; i < 2; i++) {\n\t\t\tFTL_EXPR = FTL_EXPR.replace(/<expr>/g, () => FTL_EXPR);\n\t\t}\n\t\tFTL_EXPR = FTL_EXPR.replace(/<expr>/g, /[^\\s\\S]/.source);\n\n\t\tconst stringInterpolation = /** @type {GrammarToken} */ ({\n\t\t\tpattern: RegExp(\n\t\t\t\t/(\"|')(?:(?!\\1|\\$\\{)[^\\\\]|\\\\.|\\$\\{(?:(?!\\})(?:<expr>))*\\})*\\1/.source.replace(\n\t\t\t\t\t/<expr>/g,\n\t\t\t\t\t() => FTL_EXPR\n\t\t\t\t)\n\t\t\t),\n\t\t\tgreedy: true,\n\t\t\tinside: {\n\t\t\t\t'interpolation': {\n\t\t\t\t\tpattern: RegExp(\n\t\t\t\t\t\t/((?:^|[^\\\\])(?:\\\\\\\\)*)\\$\\{(?:(?!\\})(?:<expr>))*\\}/.source.replace(\n\t\t\t\t\t\t\t/<expr>/g,\n\t\t\t\t\t\t\t() => FTL_EXPR\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\tlookbehind: true,\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'interpolation-punctuation': {\n\t\t\t\t\t\t\tpattern: /^\\$\\{|\\}$/,\n\t\t\t\t\t\t\talias: 'punctuation',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$rest: /** @type {Grammar['$rest']} */ (null), // see below\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst ftl = /** @type {Grammar} */ ({\n\t\t\t'comment': /<#--[\\s\\S]*?-->/,\n\t\t\t'string': [\n\t\t\t\t{\n\t\t\t\t\t// raw string\n\t\t\t\t\tpattern: /\\br(\"|')(?:(?!\\1)[^\\\\]|\\\\.)*\\1/,\n\t\t\t\t\tgreedy: true,\n\t\t\t\t},\n\t\t\t\tstringInterpolation,\n\t\t\t],\n\t\t\t'keyword': /\\b(?:as)\\b/,\n\t\t\t'boolean': /\\b(?:false|true)\\b/,\n\t\t\t'builtin-function': {\n\t\t\t\tpattern: /((?:^|[^?])\\?\\s*)\\w+/,\n\t\t\t\tlookbehind: true,\n\t\t\t\talias: 'function',\n\t\t\t},\n\t\t\t'function': /\\b\\w+(?=\\s*\\()/,\n\t\t\t'number': /\\b\\d+(?:\\.\\d+)?\\b/,\n\t\t\t'operator': /\\.\\.[<*!]?|->|--|\\+\\+|&&|\\|\\||\\?{1,2}|[-+*/%!=<>]=?|\\b(?:gt|gte|lt|lte)\\b/,\n\t\t\t'punctuation': /[,;.:()[\\]{}]/,\n\t\t});\n\n\t\t/** @type {GrammarToken & { inside: { interpolation: { inside: Grammar } } }} */ (\n\t\t\tstringInterpolation\n\t\t).inside.interpolation.inside.$rest = ftl;\n\n\t\treturn {\n\t\t\t'ftl-comment': {\n\t\t\t\t// the pattern is shortened to be more efficient\n\t\t\t\tpattern: /<#--[\\s\\S]*?-->/,\n\t\t\t\tgreedy: true,\n\t\t\t\talias: 'comment',\n\t\t\t},\n\t\t\t'ftl-directive': {\n\t\t\t\tpattern: RegExp(\n\t\t\t\t\t// eslint-disable-next-line regexp/no-useless-lazy\n\t\t\t\t\t/<\\/?[#@][a-zA-Z](?:<expr>)*?>/.source.replace(/<expr>/g, () => FTL_EXPR),\n\t\t\t\t\t'i'\n\t\t\t\t),\n\t\t\t\tgreedy: true,\n\t\t\t\tinside: {\n\t\t\t\t\t'directive': {\n\t\t\t\t\t\tpattern: /(^<\\/?)[#@][a-z]\\w*/i,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'keyword',\n\t\t\t\t\t},\n\t\t\t\t\t'punctuation': /^<\\/?|\\/?>$/,\n\t\t\t\t\t'content': {\n\t\t\t\t\t\tpattern: /\\s*\\S[\\s\\S]*/,\n\t\t\t\t\t\talias: 'ftl',\n\t\t\t\t\t\tinside: ftl,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t'ftl-interpolation': {\n\t\t\t\tpattern: RegExp(\n\t\t\t\t\t// eslint-disable-next-line regexp/no-useless-lazy\n\t\t\t\t\t/\\$\\{(?:<expr>)*?\\}/.source.replace(/<expr>/g, () => FTL_EXPR),\n\t\t\t\t\t'i'\n\t\t\t\t),\n\t\t\t\tgreedy: true,\n\t\t\t\tinside: {\n\t\t\t\t\t'punctuation': /^\\$\\{|\\}$/,\n\t\t\t\t\t'content': {\n\t\t\t\t\t\tpattern: /\\s*\\S[\\s\\S]*/,\n\t\t\t\t\t\talias: 'ftl',\n\t\t\t\t\t\tinside: ftl,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t$tokenize: embeddedIn('markup'),\n\t\t};\n\t},\n};\n\n/**\n * @typedef {import('../types.d.ts').Grammar} Grammar\n * @typedef {import('../types.d.ts').GrammarToken} GrammarToken\n */\n"],"names":["ftl","id","require","markup","grammar","FTL_EXPR","i","replace","stringInterpolation","pattern","RegExp","greedy","inside","interpolation","lookbehind","alias","$rest","comment","string","keyword","boolean","function","number","operator","punctuation","directive","content","$tokenize","embeddedIn"],"mappings":"mTAIA,IAAeA,EAAA,CACdC,GAAI,MACJC,QAASC,EACT,OAAAC,GAIC,IAAIC,EACH,kHAED,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACtBD,EAAWA,EAASE,QAAQ,WAAW,IAAMF,IAE9CA,EAAWA,EAASE,QAAQ,UAAW,aAEvC,MAAMC,EAAmD,CACxDC,QAASC,OACR,4EAAsEH,QACrE,WACA,IAAMF,KAGRM,QAAQ,EACRC,OAAQ,CACPC,cAAiB,CAChBJ,QAASC,OACR,8DAA2DH,QAC1D,WACA,IAAMF,KAGRS,YAAY,EACZF,OAAQ,CACP,4BAA6B,CAC5BH,QAAS,YACTM,MAAO,eAERC,MAAwC,SAMtChB,EAA8B,CACnCiB,QAAW,kBACXC,OAAU,CACT,CAECT,QAAS,iCACTE,QAAQ,GAETH,GAEDW,QAAW,aACXC,QAAW,qBACX,mBAAoB,CACnBX,QAAS,uBACTK,YAAY,EACZC,MAAO,YAERM,SAAY,iBACZC,OAAU,oBACVC,SAAY,4EACZC,YAAe,iBAOhB,OAJiF,EAE/EZ,OAAOC,cAAcD,OAAOI,MAAQhB,EAE/B,CACN,cAAe,CAEdS,QAAS,kBACTE,QAAQ,EACRI,MAAO,WAER,gBAAiB,CAChBN,QAASC,OAER,+BAAuCH,QAAQ,WAAW,IAAMF,IAChE,KAEDM,QAAQ,EACRC,OAAQ,CACPa,UAAa,CACZhB,QAAS,uBACTK,YAAY,EACZC,MAAO,WAERS,YAAe,cACfE,QAAW,CACVjB,QAAS,eACTM,MAAO,MACPH,OAAQZ,KAIX,oBAAqB,CACpBS,QAASC,OAER,wBAA4BH,QAAQ,WAAW,IAAMF,IACrD,KAEDM,QAAQ,EACRC,OAAQ,CACPY,YAAe,YACfE,QAAW,CACVjB,QAAS,eACTM,MAAO,MACPH,OAAQZ,KAIX2B,UAAWC,EAAW,UAEvB"}