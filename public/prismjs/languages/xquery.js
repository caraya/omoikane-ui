import{g as e,T as t}from"../token-Dozwbq7Q.js";import{w as n}from"../without-tokenize-Bwi0ec2C.js";import o from"./markup.js";import"./xml.js";import"../patterns-A_vPglum.js";function a(n){const o=[];for(let i=0;i<n.length;i++){const r=n[i],s="string"!=typeof r;let p=!1;if(s){const t=r.content[1];if("tag"===r.type&&"object"==typeof t&&"tag"===t.type){const n=r.content[0];if("object"==typeof n&&"</"===n.content)o.length>0&&o[o.length-1].tagName===e(t)&&o.pop();else{const n=r.content[r.content.length-1];"object"==typeof n&&"/>"===n.content||o.push({tagName:e(t),openedBraces:0})}}else{const e=n[i+1],t=n[i-1];!(o.length>0&&"punctuation"===r.type&&"{"===r.content)||"object"==typeof e&&"punctuation"===e.type&&"{"===e.content||"object"==typeof t&&"plain-text"===t.type&&"{"===t.content?o.length>0&&o[o.length-1].openedBraces>0&&"punctuation"===r.type&&"}"===r.content?o[o.length-1].openedBraces--:"comment"!==r.type&&(p=!0):o[o.length-1].openedBraces++}}if((p||!s)&&o.length>0&&0===o[o.length-1].openedBraces){let o=e(r);const a=n[i+1];!a||"string"!=typeof a&&"plain-text"!==a.type||(o+=e(a),n.splice(i+1,1));const s=n[i-1];!s||"string"!=typeof s&&"plain-text"!==s.type||(o=e(s)+o,n.splice(i-1,1),i--),n[i]=/^\s+$/.test(o)?o:new t("plain-text",o,void 0,o)}s&&"string"!=typeof r.content&&a(r.content)}}var i={id:"xquery",base:o,grammar({base:e}){const t=e.tag;t.pattern=/<\/?(?!\d)[^\s>\/=$<%]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\[\s\S]|\{(?!\{)(?:\{(?:\{[^{}]*\}|[^{}])*\}|[^{}])+\}|(?!\1)[^\\])*\1|[^\s'">=]+))?)*\s*\/?>/;const o=t.inside["attr-value"];o.pattern=/=(?:("|')(?:\\[\s\S]|\{(?!\{)(?:\{(?:\{[^{}]*\}|[^{}])*\}|[^{}])+\}|(?!\1)[^\\])*\1|[^\s'">=]+)/;const i=o.inside;return i.punctuation=/^="|"$/,i.expression={pattern:/\{(?!\{)(?:\{(?:\{[^{}]*\}|[^{}])*\}|[^{}])+\}/,alias:"language-xquery",inside:"xquery"},e.$tokenize=(e,t,o)=>{const i=o.tokenize(e,n(t));return a(i),i},{"xquery-comment":{pattern:/\(:[\s\S]*?:\)/,greedy:!0,alias:"comment"},string:{pattern:/(["'])(?:\1\1|(?!\1)[\s\S])*\1/,greedy:!0},extension:{pattern:/\(#.+?#\)/,alias:"symbol"},variable:/\$[-\w:]+/,axis:{pattern:/(^|[^-])(?:ancestor(?:-or-self)?|attribute|child|descendant(?:-or-self)?|following(?:-sibling)?|parent|preceding(?:-sibling)?|self)(?=::)/,lookbehind:!0,alias:"operator"},"keyword-operator":{pattern:/(^|[^:-])\b(?:and|castable as|div|eq|except|ge|gt|idiv|instance of|intersect|is|le|lt|mod|ne|or|union)\b(?=$|[^:-])/,lookbehind:!0,alias:"operator"},keyword:{pattern:/(^|[^:-])\b(?:as|ascending|at|base-uri|boundary-space|case|cast as|collation|construction|copy-namespaces|declare|default|descending|else|empty (?:greatest|least)|encoding|every|external|for|function|if|import|in|inherit|lax|let|map|module|namespace|no-inherit|no-preserve|option|order(?: by|ed|ing)?|preserve|return|satisfies|schema|some|stable|strict|strip|then|to|treat as|typeswitch|unordered|validate|variable|version|where|xquery)\b(?=$|[^:-])/,lookbehind:!0},function:/[\w-]+(?::[\w-]+)*(?=\s*\()/,"xquery-element":{pattern:/(element\s+)[\w-]+(?::[\w-]+)*/,lookbehind:!0,alias:"tag"},"xquery-attribute":{pattern:/(attribute\s+)[\w-]+(?::[\w-]+)*/,lookbehind:!0,alias:"attr-name"},builtin:{pattern:/(^|[^:-])\b(?:attribute|comment|document|element|processing-instruction|text|xs:(?:ENTITIES|ENTITY|ID|IDREFS?|NCName|NMTOKENS?|NOTATION|Name|QName|anyAtomicType|anyType|anyURI|base64Binary|boolean|byte|date|dateTime|dayTimeDuration|decimal|double|duration|float|gDay|gMonth|gMonthDay|gYear|gYearMonth|hexBinary|int|integer|language|long|negativeInteger|nonNegativeInteger|nonPositiveInteger|normalizedString|positiveInteger|short|string|time|token|unsigned(?:Byte|Int|Long|Short)|untyped(?:Atomic)?|yearMonthDuration))\b(?=$|[^:-])/,lookbehind:!0},number:/\b\d+(?:\.\d+)?(?:E[+-]?\d+)?/,operator:[/[+*=?|@]|\.\.?|:=|!=|<[=<]?|>[=>]?/,{pattern:/(\s)-(?=\s)/,lookbehind:!0}],punctuation:/[[\](){},;:/]/}}};export{i as default};
