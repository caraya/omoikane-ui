{"version":3,"file":"http.js","sources":["../../src/languages/http.js"],"sourcesContent":["/** @type {import('../types.d.ts').LanguageProto<'http'>} */\nexport default {\n\tid: 'http',\n\toptional: 'json',\n\tgrammar ({ getOptionalLanguage }) {\n\t\t/**\n\t\t * @param {string} name\n\t\t * @returns {RegExp}\n\t\t */\n\t\tfunction headerValueOf (name) {\n\t\t\treturn RegExp('(^(?:' + name + '):[ \\t]*(?![ \\t]))[^]+', 'i');\n\t\t}\n\n\t\t// Create a mapping of Content-Type headers to language definitions\n\t\tconst httpLanguages = {\n\t\t\t'application/javascript': 'javascript',\n\t\t\t'application/json': getOptionalLanguage('json') || 'javascript',\n\t\t\t'application/xml': 'xml',\n\t\t\t'text/xml': 'xml',\n\t\t\t'text/html': 'html',\n\t\t\t'text/css': 'css',\n\t\t\t'text/plain': 'plain',\n\t\t};\n\n\t\t// Declare which types can also be suffixes\n\t\tconst suffixTypes = {\n\t\t\t'application/json': true,\n\t\t\t'application/xml': true,\n\t\t};\n\n\t\t/**\n\t\t * Returns a pattern for the given content type which matches it and any type which has it as a suffix.\n\t\t *\n\t\t * @param {string} contentType\n\t\t * @returns {string}\n\t\t */\n\t\tfunction getSuffixPattern (contentType) {\n\t\t\tconst suffix = contentType.replace(/^[a-z]+\\//, '');\n\t\t\tconst suffixPattern = '\\\\w+/(?:[\\\\w.-]+\\\\+)+' + suffix + '(?![+\\\\w.-])';\n\t\t\treturn '(?:' + contentType + '|' + suffixPattern + ')';\n\t\t}\n\n\t\t// Insert each content type parser that has its associated language\n\t\t// currently loaded.\n\n\t\tconst options = /** @type {import('../types.d.ts').GrammarTokens} */ ({});\n\t\tfor (const key in httpLanguages) {\n\t\t\tconst contentType = key;\n\n\t\t\tconst pattern = suffixTypes[contentType] ? getSuffixPattern(contentType) : contentType;\n\t\t\toptions[contentType.replace(/\\//g, '-')] = {\n\t\t\t\tpattern: RegExp(\n\t\t\t\t\t'(' +\n\t\t\t\t\t\t/content-type:\\s*/.source +\n\t\t\t\t\t\tpattern +\n\t\t\t\t\t\t/(?:(?:\\r\\n?|\\n)[\\w-].*)*(?:\\r(?:\\n|(?!\\n))|\\n)/.source +\n\t\t\t\t\t\t')' +\n\t\t\t\t\t\t// This is a little interesting:\n\t\t\t\t\t\t// The HTTP format spec required 1 empty line before the body to make everything unambiguous.\n\t\t\t\t\t\t// However, when writing code by hand (e.g. to display on a website) people can forget about this,\n\t\t\t\t\t\t// so we want to be liberal here. We will allow the empty line to be omitted if the first line of\n\t\t\t\t\t\t// the body does not start with a [\\w-] character (as headers do).\n\t\t\t\t\t\t/[^ \\t\\w-][\\s\\S]*/.source,\n\t\t\t\t\t'i'\n\t\t\t\t),\n\t\t\t\tlookbehind: true,\n\t\t\t\tinside: httpLanguages[contentType],\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\t'request-line': {\n\t\t\t\tpattern:\n\t\t\t\t\t/^(?:CONNECT|DELETE|GET|HEAD|OPTIONS|PATCH|POST|PRI|PUT|SEARCH|TRACE)\\s(?:https?:\\/\\/|\\/)\\S*\\sHTTP\\/[\\d.]+/m,\n\t\t\t\tinside: {\n\t\t\t\t\t// HTTP Method\n\t\t\t\t\t'method': {\n\t\t\t\t\t\tpattern: /^[A-Z]+\\b/,\n\t\t\t\t\t\talias: 'property',\n\t\t\t\t\t},\n\t\t\t\t\t// Request Target e.g. http://example.com, /path/to/file\n\t\t\t\t\t'request-target': {\n\t\t\t\t\t\tpattern: /^(\\s)(?:https?:\\/\\/|\\/)\\S*(?=\\s)/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'url',\n\t\t\t\t\t\tinside: 'uri',\n\t\t\t\t\t},\n\t\t\t\t\t// HTTP Version\n\t\t\t\t\t'http-version': {\n\t\t\t\t\t\tpattern: /^(\\s)HTTP\\/[\\d.]+/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'property',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t'response-status': {\n\t\t\t\tpattern: /^HTTP\\/[\\d.]+ \\d+ .+/m,\n\t\t\t\tinside: {\n\t\t\t\t\t// HTTP Version\n\t\t\t\t\t'http-version': {\n\t\t\t\t\t\tpattern: /^HTTP\\/[\\d.]+/,\n\t\t\t\t\t\talias: 'property',\n\t\t\t\t\t},\n\t\t\t\t\t// Status Code\n\t\t\t\t\t'status-code': {\n\t\t\t\t\t\tpattern: /^(\\s)\\d+(?=\\s)/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'number',\n\t\t\t\t\t},\n\t\t\t\t\t// Reason Phrase\n\t\t\t\t\t'reason-phrase': {\n\t\t\t\t\t\tpattern: /^(\\s).+/,\n\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\talias: 'string',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t'header': {\n\t\t\t\tpattern: /^[\\w-]+:.+(?:(?:\\r\\n?|\\n)[ \\t].+)*/m,\n\t\t\t\tinside: {\n\t\t\t\t\t'header-value': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: headerValueOf(/Content-Security-Policy/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: ['csp', 'languages-csp'],\n\t\t\t\t\t\t\tinside: 'csp',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: headerValueOf(/Public-Key-Pins(?:-Report-Only)?/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: ['hpkp', 'languages-hpkp'],\n\t\t\t\t\t\t\tinside: 'hpkp',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: headerValueOf(/Strict-Transport-Security/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t\talias: ['hsts', 'languages-hsts'],\n\t\t\t\t\t\t\tinside: 'hsts',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: headerValueOf(/[^:]+/.source),\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\t'header-name': {\n\t\t\t\t\t\tpattern: /^[^:]+/,\n\t\t\t\t\t\talias: 'keyword',\n\t\t\t\t\t},\n\t\t\t\t\t'punctuation': /^:/,\n\t\t\t\t},\n\t\t\t},\n\t\t\t$insertBefore: {\n\t\t\t\t'header': options,\n\t\t\t},\n\t\t};\n\t},\n};\n"],"names":["http","id","optional","grammar","getOptionalLanguage","headerValueOf","name","RegExp","httpLanguages","suffixTypes","getSuffixPattern","contentType","suffix","replace","options","key","pattern","lookbehind","inside","method","alias","header","punctuation","$insertBefore"],"mappings":"AACA,IAAeA,EAAA,CACdC,GAAI,OACJC,SAAU,OACV,OAAAC,EAASC,oBAAEA,IAKV,SAASC,EAAeC,GACvB,OAAOC,OAAO,QAAUD,EAAO,yBAA0B,IAC5D,CAGE,MAAME,EAAgB,CACrB,yBAA0B,aAC1B,mBAAoBJ,EAAoB,SAAW,aACnD,kBAAmB,MACnB,WAAY,MACZ,YAAa,OACb,WAAY,MACZ,aAAc,SAITK,EAAc,CACnB,oBAAoB,EACpB,mBAAmB,GASpB,SAASC,EAAkBC,GAC1B,MAAMC,EAASD,EAAYE,QAAQ,YAAa,IAEhD,MAAO,MAAQF,EAAR,yBADyCC,EACzC,eACV,CAKE,MAAME,EAAgE,CAAE,EACxE,IAAK,MAAMC,KAAOP,EAAe,CAChC,MAAMG,EAAcI,EAEdC,EAAUP,EAAYE,GAAeD,EAAiBC,GAAeA,EAC3EG,EAAQH,EAAYE,QAAQ,MAAO,MAAQ,CAC1CG,QAAST,OACR,qBAECS,EAFD,iEAWA,KAEDC,YAAY,EACZC,OAAQV,EAAcG,GAE1B,CAEE,MAAO,CACN,eAAgB,CACfK,QACC,6GACDE,OAAQ,CAEPC,OAAU,CACTH,QAAS,YACTI,MAAO,YAGR,iBAAkB,CACjBJ,QAAS,mCACTC,YAAY,EACZG,MAAO,MACPF,OAAQ,OAGT,eAAgB,CACfF,QAAS,oBACTC,YAAY,EACZG,MAAO,cAIV,kBAAmB,CAClBJ,QAAS,wBACTE,OAAQ,CAEP,eAAgB,CACfF,QAAS,gBACTI,MAAO,YAGR,cAAe,CACdJ,QAAS,iBACTC,YAAY,EACZG,MAAO,UAGR,gBAAiB,CAChBJ,QAAS,UACTC,YAAY,EACZG,MAAO,YAIVC,OAAU,CACTL,QAAS,sCACTE,OAAQ,CACP,eAAgB,CACf,CACCF,QAASX,EAAc,2BACvBY,YAAY,EACZG,MAAO,CAAC,MAAO,iBACfF,OAAQ,OAET,CACCF,QAASX,EAAc,oCACvBY,YAAY,EACZG,MAAO,CAAC,OAAQ,kBAChBF,OAAQ,QAET,CACCF,QAASX,EAAc,6BACvBY,YAAY,EACZG,MAAO,CAAC,OAAQ,kBAChBF,OAAQ,QAET,CACCF,QAASX,EAAc,SACvBY,YAAY,IAGd,cAAe,CACdD,QAAS,SACTI,MAAO,WAERE,YAAe,OAGjBC,cAAe,CACdF,OAAUP,GAGZ"}