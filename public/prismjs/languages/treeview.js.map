{"version":3,"file":"treeview.js","sources":["../../src/languages/treeview.js"],"sourcesContent":["import { getTextContent } from '../core/classes/token.js';\nimport { withoutTokenize } from '../util/language-util.js';\n\n/** @type {import('../types.d.ts').LanguageProto<'treeview'>} */\nexport default {\n\tid: 'treeview',\n\talias: 'tree-view',\n\tgrammar: {\n\t\t'treeview-part': {\n\t\t\tpattern: /^.+/m,\n\t\t\tinside: {\n\t\t\t\t'entry-line': [\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: /\\|-- |├── /,\n\t\t\t\t\t\talias: 'line-h',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: /\\| {3}|│ {3}/,\n\t\t\t\t\t\talias: 'line-v',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: /`-- |└── /,\n\t\t\t\t\t\talias: 'line-v-last',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: / {4}/,\n\t\t\t\t\t\talias: 'line-v-gap',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t'entry-name': {\n\t\t\t\t\tpattern: /\\S(?:.*\\S)?/,\n\t\t\t\t\tinside: {\n\t\t\t\t\t\t'directory-marker': {\n\t\t\t\t\t\t\tpattern: /(^|[^\\\\])\\/$/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'file-marker': {\n\t\t\t\t\t\t\tpattern: /(^|[^\\\\])[=*|]$/,\n\t\t\t\t\t\t\tlookbehind: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'symlink': {\n\t\t\t\t\t\t\tpattern: / -> /,\n\t\t\t\t\t\t\talias: 'operator',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t/** @type {Grammar['$tokenize']} */\n\t\t\t\t$tokenize (code, grammar, Prism) {\n\t\t\t\t\tconst tokens = Prism.tokenize(code, withoutTokenize(grammar));\n\n\t\t\t\t\tfor (const token of tokens) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttypeof token === 'string' ||\n\t\t\t\t\t\t\ttoken.type !== 'entry-name' ||\n\t\t\t\t\t\t\ttypeof token.content === 'string'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttoken.content.some(t => typeof t !== 'string' && t.type === 'symlink')\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst text = getTextContent(token);\n\n\t\t\t\t\t\tconst folderPattern = /(?:^|[^\\\\])\\/$/;\n\t\t\t\t\t\tif (folderPattern.test(text)) {\n\t\t\t\t\t\t\t// folder\n\t\t\t\t\t\t\ttoken.addAlias('dir');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// file\n\n\t\t\t\t\t\t\tconst parts = text\n\t\t\t\t\t\t\t\t.replace(/(^|[^\\\\])[=*|]$/, '$1')\n\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t.replace(/\\s+/g, '')\n\t\t\t\t\t\t\t\t.split('.');\n\n\t\t\t\t\t\t\twhile (parts.length > 1) {\n\t\t\t\t\t\t\t\tparts.shift();\n\t\t\t\t\t\t\t\t// Ex. 'foo.min.js' would become '<span class=\"token keyword ext-min-js ext-js\">foo.min.js</span>'\n\t\t\t\t\t\t\t\ttoken.addAlias('ext-' + parts.join('-'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (text.startsWith('.')) {\n\t\t\t\t\t\t\ttoken.addAlias('dotfile');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tokens;\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n};\n\n/**\n * @typedef {import('../types.d.ts').Grammar} Grammar\n */\n"],"names":["treeview","id","alias","grammar","pattern","inside","lookbehind","symlink","$tokenize","code","Prism","tokens","tokenize","withoutTokenize","token","type","content","some","t","text","getTextContent","test","addAlias","parts","replace","toLowerCase","split","length","shift","join","startsWith"],"mappings":"6FAIA,IAAeA,EAAA,CACdC,GAAI,WACJC,MAAO,YACRC,QAAA,KAAA,CAAA,gBAAA,CAAAC,QAAA,OAAAC,OAAA,CAAA,aAAA,CAAA,CAAAD,QAAA,aAAAF,MAAA,UAAA,CAAAE,QAAA,eAAAF,MAAA,UAAA,CAAAE,QAAA,YAAAF,MAAA,eAAA,CAAAE,QAAA,OAAAF,MAAA,eAAA,aAAA,CAAAE,QAAA,cAAAC,OAAA,CAAA,mBAAA,CAAAD,QAAA,eAAAE,YAAA,GAAA,cAAA,CAAAF,QAAA,kBAAAE,YAAA,GAAAC,QAAA,CAAAH,QAAA,OAAAF,MAAA,cAAA,SAAAM,CAAAC,EAAAN,EAAAO,GAAA,MAAAC,EAAAD,EAAAE,SAAAH,EAAAI,EAAAV,IAAA,IAAA,MAAAW,KAAAH,EAAA,CAAA,GAAA,iBAAAG,GAAA,eAAAA,EAAAC,MAAA,iBAAAD,EAAAE,QAAA,SAAA,GAAAF,EAAAE,QAAAC,MAAAC,GAAA,iBAAAA,GAAA,YAAAA,EAAAH,OAAA,SAAA,MAAAI,EAAAC,EAAAN,GAAA,GAAA,iBAAAO,KAAAF,GAAAL,EAAAQ,SAAA,WAAA,CAAA,MAAAC,EAAAJ,EAAAK,QAAA,kBAAA,MAAAC,cAAAD,QAAA,OAAA,IAAAE,MAAA,KAAA,KAAAH,EAAAI,OAAA,GAAAJ,EAAAK,QAAAd,EAAAQ,SAAA,OAAAC,EAAAM,KAAA,KAAA,CAAAV,EAAAW,WAAA,MAAAhB,EAAAQ,SAAA,UAAA,CAAA,OAAAX,CAAA"}