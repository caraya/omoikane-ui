import{p as e,i as t}from"../prism-DU08x7FD.js";import"../util-DdJteTVJ.js";import"../token-Dozwbq7Q.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";function n(e){return 1===e.nodeType}function o(e){return 3===e.nodeType}const s={id:"keep-markup",optional:"normalize-whitespace",effect:e=>e.hooks.add({"before-highlight":e=>{if(!e.element.children.length)return;if(!t(e.element,"keep-markup",!0))return;const s=t(e.element,"drop-tokens",!1);let r=0;const a=[];function i(e){if(!(e=>!s||"span"!==e.nodeName.toLowerCase()||!e.classList.contains("token"))(e))return void d(e);const t={element:e,posOpen:r,posClose:NaN};a.push(t),d(e),t.posClose=r}function d(e){for(let t=0,s=e.childNodes.length;t<s;t++){const s=e.childNodes[t];n(s)?i(s):o(s)&&(r+=s.data.length)}}d(e.element),a.length&&(e.markupData=a)},"after-highlight":e=>{const t=e.markupData??[];if(t.length){const s=(e,t)=>{for(let r=0,a=e.childNodes.length;r<a;r++){const a=e.childNodes[r];if(n(a)){if(!s(a,t))return!1}else o(a)&&(!t.start&&t.pos+a.data.length>t.node.posOpen&&(t.start=[a,t.node.posOpen-t.pos]),t.start&&t.pos+a.data.length>=t.node.posClose&&(t.end=[a,t.node.posClose-t.pos]),t.pos+=a.data.length);if(t.start&&t.end){const e=document.createRange();return e.setStart(...t.start),e.setEnd(...t.end),t.node.element.innerHTML="",t.node.element.appendChild(e.extractContents()),e.insertNode(t.node.element),e.detach(),!1}}return!0};t.forEach((t=>{s(e.element,{node:t,pos:0})})),e.highlightedCode=e.element.innerHTML}}})};e.pluginRegistry.add(s);export{s as default};
