import{p as e,i as t}from"../prism-DU08x7FD.js";import{n as i,l as n}from"../util-DdJteTVJ.js";import{c as s}from"../combine-callbacks-CN2XYGOO.js";import"../token-Dozwbq7Q.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";const o="linkable-line-numbers",r=/\n(?!$)/g;function l(e,t=document){return[...t.querySelectorAll(e)]}function a(e){e()}const c=n((()=>{const e=document.createElement("div");e.style.fontSize="13px",e.style.lineHeight="1.5",e.style.padding="0",e.style.border="0",e.innerHTML="&nbsp;<br />&nbsp;",document.body.appendChild(e);const t=38===e.offsetHeight;return document.body.removeChild(e),t}));class LineHighlight{scrollIntoView=!0;Prism;constructor(e){this.Prism=e}highlightLines(e,i,n=""){const s=(i="string"==typeof i?i:e.getAttribute("data-line")||"").replace(/\s+/g,"").split(",").filter(Boolean),l=+e.getAttribute("data-line-offset")||0,h=(c()?parseInt:parseFloat)(getComputedStyle(e).lineHeight),p=t(e,"line-numbers"),u=e.querySelector("code"),g=p?e:u||e,d=[],m=u?.textContent?.match(r),f=m?m.length+1:1,y=u&&g!==u?((e,t)=>{const i=getComputedStyle(e),n=getComputedStyle(t);function s(e){return+e.substr(0,e.length-2)}return t.offsetTop+s(n.borderTopWidth)+s(n.paddingTop)-s(i.paddingTop)})(e,u):0;s.forEach((t=>{const i=t.split("-"),s=+i[0];let o=+i[1]||s;if(o=Math.min(f+l,o),o<s)return;const r=e.querySelector('.line-highlight[data-range="'+t+'"]')||document.createElement("div");if(d.push((()=>{r.setAttribute("aria-hidden","true"),r.setAttribute("data-range",t),r.className=n+" line-highlight"})),p&&this.Prism.pluginRegistry.peek("line-numbers")?.plugin){const t=this.Prism.pluginRegistry.peek("line-numbers")?.plugin,i=t.getLine(e,s),n=t.getLine(e,o);if(i){const e=i.offsetTop+y+"px";d.push((()=>{r.style.top=e}))}if(i&&n){const e=n.offsetTop-i.offsetTop+n.offsetHeight+"px";d.push((()=>{r.style.height=e}))}}else d.push((()=>{r.setAttribute("data-start",s+""),o>s&&r.setAttribute("data-end",o+""),r.style.top=(s-l-1)*h+y+"px",r.textContent=Array(o-s+2).join(" \n")}));d.push((()=>{r.style.width=e.scrollWidth+"px"})),d.push((()=>{g.appendChild(r)}))}));const b=e.id;if(p&&this.Prism.pluginRegistry.peek("line-numbers")?.plugin&&t(e,o)&&b){L=o,e.classList.contains(L)||d.push((()=>{e.classList.add(o)}));const t=parseInt(e.getAttribute("data-start")||"1"),i=this.Prism.pluginRegistry.peek("line-numbers")?.plugin;i.getLines(e)?.forEach(((e,i)=>{const n=i+t;e.onclick=()=>{const e=`${b}.${n}`;this.scrollIntoView=!1,location.hash=e,setTimeout((()=>{this.scrollIntoView=!0}),1)}}))}var L;return()=>{d.forEach(a)}}}const h={id:"line-highlight",optional:"line-numbers",plugin:e=>new LineHighlight(e),effect(e){if("undefined"==typeof document)return i;function n(e){return!!(e&&/pre/i.test(e.nodeName)&&(e.hasAttribute("data-line")||e.id&&t(e,o)))}const r=()=>{const t=location.hash.slice(1);l(".temporary.line-highlight").forEach((e=>{e.remove()}));const i=(t.match(/\.([\d,-]+)$/)||[,""])[1];if(!i||document.getElementById(t))return;const n=t.slice(0,t.lastIndexOf(".")),s=document.getElementById(n);if(!s)return;s.hasAttribute("data-line")||s.setAttribute("data-line","");const o=e.pluginRegistry.peek(h)?.plugin;o.highlightLines(s,i,"temporary ")(),o.scrollIntoView&&document.querySelector(".temporary.line-highlight")?.scrollIntoView()},c=()=>{l("pre").filter(n).map((t=>{const i=e.pluginRegistry.peek(h)?.plugin;return i.highlightLines(t)})).forEach(a)};let p;window.addEventListener("hashchange",r),window.addEventListener("resize",c);const u=e.hooks.add("before-sanity-check",(e=>{const t=e.element.parentElement;if(!n(t))return;let i=0;l(".line-highlight",t).forEach((e=>{i+=(e.textContent||"").length,e.remove()})),i&&/^(?: \n)+$/.test(e.code.slice(-i))&&(e.code=e.code.slice(0,-i))})),g=e.hooks.add("complete",(t=>{const i=t.element.parentElement;if(!n(i))return;void 0!==p&&clearTimeout(p);const s=e.pluginRegistry.peek(h)?.plugin;s.highlightLines(i)(),p=setTimeout(r,1)}));return s((()=>{window.removeEventListener("hashchange",r),window.removeEventListener("resize",c)}),u,g)}};e.pluginRegistry.add(h);export{LineHighlight,h as default};
