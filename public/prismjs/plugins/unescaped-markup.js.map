{"version":3,"file":"unescaped-markup.js","sources":["../../src/plugins/unescaped-markup/unescaped-markup.js"],"sourcesContent":["import prism from '../../global.js';\n\n/** @type {import('../../types.d.ts').PluginProto<'unescaped-markup'>} */\nconst Self = {\n\tid: 'unescaped-markup',\n\teffect (Prism) {\n\t\treturn Prism.hooks.add({\n\t\t\t'before-highlightall': env => {\n\t\t\t\tenv.selector +=\n\t\t\t\t\t', [class*=\"lang-\"] script[type=\"text/plain\"]' +\n\t\t\t\t\t', [class*=\"language-\"] script[type=\"text/plain\"]' +\n\t\t\t\t\t', script[type=\"text/plain\"][class*=\"lang-\"]' +\n\t\t\t\t\t', script[type=\"text/plain\"][class*=\"language-\"]';\n\t\t\t},\n\t\t\t'before-sanity-check': env => {\n\t\t\t\t/** @type {HTMLElement} */\n\t\t\t\tconst element = env.element;\n\n\t\t\t\tif (element.matches('script[type=\"text/plain\"]')) {\n\t\t\t\t\t// found a <script type=\"text/plain\" ...> element\n\t\t\t\t\t// we convert this element to a regular <pre><code> code block\n\n\t\t\t\t\tconst code = document.createElement('code');\n\t\t\t\t\tconst pre = document.createElement('pre');\n\n\t\t\t\t\t// copy class name\n\t\t\t\t\tpre.className = code.className = element.className;\n\n\t\t\t\t\t// copy all \"data-\" attributes\n\t\t\t\t\tconst dataset = element.dataset;\n\t\t\t\t\tObject.keys(dataset || {}).forEach(key => {\n\t\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(dataset, key)) {\n\t\t\t\t\t\t\tpre.dataset[key] = dataset[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tcode.textContent = env.code = env.code.replace(\n\t\t\t\t\t\t/&lt;\\/script(?:>|&gt;)/gi,\n\t\t\t\t\t\t'</scri' + 'pt>'\n\t\t\t\t\t);\n\n\t\t\t\t\t// change DOM\n\t\t\t\t\tpre.appendChild(code);\n\t\t\t\t\telement.replaceWith(pre);\n\t\t\t\t\tenv.element = code;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!env.code) {\n\t\t\t\t\t// no code\n\t\t\t\t\tconst childNodes = element.childNodes;\n\t\t\t\t\tif (childNodes.length === 1 && childNodes[0].nodeName === '#comment') {\n\t\t\t\t\t\t// the only child is a comment -> use the comment's text\n\t\t\t\t\t\telement.textContent = env.code = childNodes[0].textContent || '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n};\n\nexport default Self;\n\nprism.pluginRegistry.add(Self);\n"],"names":["Self","id","effect","Prism","hooks","add","env","selector","element","matches","code","document","createElement","pre","className","dataset","Object","keys","forEach","key","prototype","hasOwnProperty","call","textContent","replace","appendChild","replaceWith","childNodes","length","nodeName","prism","pluginRegistry"],"mappings":"iKAGK,MAACA,EAAO,CACZC,GAAI,mBACJC,OAAQC,GACAA,EAAMC,MAAMC,IAAI,CACtB,sBAAuBC,IACtBA,EAAIC,UACH,wLAGiD,EAEnD,sBAAuBD,IAEtB,MAAME,EAAUF,EAAIE,QAEpB,GAAIA,EAAQC,QAAQ,6BAA8B,CAIjD,MAAMC,EAAOC,SAASC,cAAc,QAC9BC,EAAMF,SAASC,cAAc,OAGnCC,EAAIC,UAAYJ,EAAKI,UAAYN,EAAQM,UAGzC,MAAMC,EAAUP,EAAQO,QAgBxB,OAfAC,OAAOC,KAAKF,GAAW,CAAE,GAAEG,SAAQC,IAC9BH,OAAOI,UAAUC,eAAeC,KAAKP,EAASI,KACjDN,EAAIE,QAAQI,GAAOJ,EAAQI,GAClC,IAGKT,EAAKa,YAAcjB,EAAII,KAAOJ,EAAII,KAAKc,QACtC,2BACA,cAIDX,EAAIY,YAAYf,GAChBF,EAAQkB,YAAYb,QACpBP,EAAIE,QAAUE,EAEnB,CAEI,IAAKJ,EAAII,KAAM,CAEd,MAAMiB,EAAanB,EAAQmB,WACD,IAAtBA,EAAWC,QAA2C,aAA3BD,EAAW,GAAGE,WAE5CrB,EAAQe,YAAcjB,EAAII,KAAOiB,EAAW,GAAGJ,aAAe,GAEpE,MAQAO,EAAMC,eAAe1B,IAAIL"}