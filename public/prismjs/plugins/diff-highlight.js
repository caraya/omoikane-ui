import{g as e,T as t}from"../token-Dozwbq7Q.js";import{p as n}from"../prism-DU08x7FD.js";import s,{PREFIXES as o}from"../languages/diff.js";import"../util-DdJteTVJ.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";const r={id:"diff-highlight",require:s,effect(n){const s=/^diff-([\w-]+)/i,r=e=>{const t=e.language;s.test(t)&&!e.grammar&&(e.grammar=n.languageRegistry.getLanguage("diff")?.resolvedGrammar)};return n.hooks.add({"before-sanity-check":r,"before-tokenize":r,"after-tokenize":r=>{const i=s.exec(r.language);if(!i)return;const g=i[1],a=n.languageRegistry.getLanguage(g)?.resolvedGrammar;if(a)for(const s of r.tokens){if("string"==typeof s||!(s.type in o)||!Array.isArray(s.content))continue;const r=s.type;let i=0;const g=()=>(i++,new t("prefix",o[r],/\w+/.exec(r)?.[0])),f=s.content.filter((e=>"string"==typeof e||"prefix"!==e.type)),c=s.content.length-f.length,l=n.tokenize(e(f),a);l.unshift(g());const p=/\r\n|\n/g,u=e=>{const t=[];p.lastIndex=0;let n,s=0;for(;i<c&&(n=p.exec(e));){const o=n.index+n[0].length;t.push(e.slice(s,o)),s=o,t.push(g())}if(0!==t.length)return s<e.length&&t.push(e.slice(s)),t},m=e=>{for(let t=0;t<e.length&&i<c;t++){const n=e[t];if("string"==typeof n){const s=u(n);s&&(e.splice(t,1,...s),t+=s.length-1)}else if("string"==typeof n.content){const e=u(n.content);e&&(n.content=e)}else m(n.content)}};m(l),i<c&&l.push(g()),s.content=l}}})}};n.pluginRegistry.add(r);export{r as default};
