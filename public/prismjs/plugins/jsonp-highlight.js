import{p as t}from"../prism-DU08x7FD.js";import"../util-DdJteTVJ.js";import"../token-Dozwbq7Q.js";import"../insert-CpDsPTVw.js";import"../iterables-BnTatl6v.js";function e(){return"object"==typeof window?window:{}}let r=0;const n="data-jsonp-status",a="loading",s="loaded",o="failed",i="pre[data-jsonp]:not(["+n+'="'+s+'"]):not(['+n+'="'+a+'"])';class JsonpHighlight{timeout=5e3;Prism;adapters=[];constructor(t){this.Prism=t}getAdapter(t){if("function"==typeof t){for(const e of this.adapters)if(e.adapter.valueOf()===t.valueOf())return e.adapter}else if("string"==typeof t)for(const e of this.adapters)if(e.name===t)return e.adapter;return null}registerAdapter(t,e){"function"!=typeof e||this.getAdapter(e)||this.getAdapter(t)||this.adapters.push({adapter:e,name:t})}removeAdapter(t){const e="string"==typeof t?this.getAdapter(t):t;if(e){const t=this.adapters.findIndex((t=>t.adapter===e));t>=0&&this.adapters.splice(t,1)}}runAdapters(...t){for(const e of this.adapters){const r=e.adapter(...t);if(null!==r)return r}return null}highlight(t=document){const e=t.querySelectorAll(i);for(const t of e)this.Prism.highlightElement(t)}}const u={id:"jsonp-highlight",plugin(t){const e=new JsonpHighlight(t);return e.registerAdapter("github",(t=>{if(t&&t.meta&&t.data){if(t.meta.status&&t.meta.status>=400)return"Error: "+(t.data.message||t.meta.status);if("string"==typeof t.data.content)return"function"==typeof atob?atob(t.data.content.replace(/\s/g,"")):"Your browser cannot decode base64"}return null})),e.registerAdapter("gist",((t,e)=>{if(t&&t.meta&&t.data&&t.data.files){if(t.meta.status&&t.meta.status>=400)return"Error: "+(t.data.message||t.meta.status);const r=t.data.files;let n=e.getAttribute("data-filename");if(null==n)for(const t in r)if(r.hasOwnProperty(t)){n=t;break}return n&&void 0!==r[n]?r[n].content+"":"Error: unknown or missing gist file "+n}return null})),e.registerAdapter("bitbucket",(t=>t&&t.node&&"string"==typeof t.data?t.data+"":null)),e},effect(t){const d=t.pluginRegistry.peek(u)?.plugin;return t.hooks.add({"before-highlightall":t=>{t.selector+=", "+i},"before-sanity-check":u=>{const l=u.element;if(!l.matches(i))return;const p=l.getAttribute("data-jsonp");if(!p)return;u.code="",l.setAttribute(n,a);const c=l.appendChild(document.createElement("CODE"));c.textContent="Loading…";const f=u.language;c.className="language-"+f;const g=t.pluginRegistry.peek("autoloader")?.plugin;g&&g.preloadLanguages(f);const h=l.getAttribute("data-adapter");let m=null;if(h){const t=e();if("function"!=typeof t[h])return l.setAttribute(n,o),void(c.textContent=(b=h,'✖ Error: JSONP adapter function "'+b+"\" doesn't exist"));m=t[h]}var b;((a,i,u,p,f)=>{const g="prismjsonp"+r++,h=document.createElement("a");h.href=a,h.href+=(h.search?"&":"?")+(i||"callback")+"="+g;const b=document.createElement("script");b.src=h.href,b.onerror=()=>{E(),f()};const A=setTimeout((()=>{E(),f()}),u),y=e();function E(){clearTimeout(A),document.head.removeChild(b),delete y[g]}y[g]=e=>{E(),(e=>{let r;r=m?m(e,l):d.runAdapters(e,l),null===r?(l.setAttribute(n,o),c.textContent="✖ Error: Cannot parse response (perhaps you need an adapter function?)"):(l.setAttribute(n,s),c.textContent=r,t.highlightElement(c))})(e)},document.head.appendChild(b)})(p,l.getAttribute("data-callback"),d.timeout,0,(()=>{l.setAttribute(n,o),c.textContent="✖ Error: Timeout loading "+p}))}})}};t.pluginRegistry.add(u);export{JsonpHighlight,u as default};
